        // ============================================
        // End OCC Filings Functions
        // ============================================

        // ============================================
        // Document Detail & Viewer Functions
        // (Thin wrappers around shared-document-detail.txt)
        // ============================================

        // Map-specific state for detail modal
        let mapCurrentDocumentId = null;
        let mapCurrentDocumentFilename = null;
        let mapCurrentDocumentContentType = null;

        // Open document detail modal (fetches doc, renders via shared renderDocDetailContent)
        async function openMapDocumentDetail(docId, displayName) {
            console.log('Opening document detail:', docId, displayName);
            mapCurrentDocumentId = docId;
            mapCurrentDocumentFilename = displayName;

            // Show modal with loading state
            document.getElementById('mapDocumentDetailModal').style.display = 'flex';
            document.getElementById('mapDocModalTitle').textContent = 'Loading...';
            document.getElementById('mapDocModalSubtitle').textContent = '';
            document.getElementById('mapDocDetailContent').innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280;">Loading document details...</div>';

            try {
                const response = await fetch(`/api/documents/${docId}`);
                if (!response.ok) throw new Error('Failed to fetch document details');

                const data = await response.json();
                const doc = data.document;

                if (!doc) {
                    throw new Error('Document not found');
                }

                mapCurrentDocumentContentType = doc.content_type || 'application/pdf';
                mapCurrentDocumentFilename = doc.display_name || doc.filename || displayName;

                // Update header — use shared formatDocType
                document.getElementById('mapDocModalTitle').textContent = formatDocType(doc.category || doc.doc_type) || 'Document Details';
                document.getElementById('mapDocModalSubtitle').textContent = doc.display_name || doc.filename || displayName;

                // Build content using shared renderer
                document.getElementById('mapDocDetailContent').innerHTML = renderDocDetailContent(doc);

            } catch (error) {
                console.error('Error fetching document details:', error);
                document.getElementById('mapDocModalTitle').textContent = 'Error';
                document.getElementById('mapDocDetailContent').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #dc2626;">
                        <p>Failed to load document details</p>
                        <button onclick="viewMapDocumentPDF()" style="margin-top: 16px; background: var(--slate-blue); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">
                            View Original Document
                        </button>
                    </div>`;
            }
        }

        function closeMapDocumentDetail() {
            document.getElementById('mapDocumentDetailModal').style.display = 'none';
        }

        function viewMapDocumentPDF() {
            if (mapCurrentDocumentId) {
                closeMapDocumentDetail();
                viewMapDocument(mapCurrentDocumentId, mapCurrentDocumentFilename, mapCurrentDocumentContentType);
            }
        }

        function printMapDocumentSummary() {
            printDocSummary(mapCurrentDocumentId);
        }

        // Open document viewer — delegates to shared openDocumentViewer with map-specific DOM elements
        async function viewMapDocument(docId, filename, contentType) {
            mapCurrentDocumentId = docId;
            await openDocumentViewer(docId, filename, contentType, {
                container: document.getElementById('mapPdfViewerContainer'),
                titleEl: document.getElementById('documentViewTitle'),
                modal: document.getElementById('documentViewModal')
            });
        }

        function closeMapDocumentViewer() {
            closeDocumentViewerShared({
                container: document.getElementById('mapPdfViewerContainer'),
                modal: document.getElementById('documentViewModal')
            });
            mapCurrentDocumentId = null;
        }

        function downloadMapDocument() {
            downloadViewerDocument();
        }

        // ============================================
        // End Document Viewer Functions
        // ============================================
