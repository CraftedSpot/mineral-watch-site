<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operator Directory - Mineral Watch</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
/* __OPERATORS_CSS__ */
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-inner">
                <a href="/" class="logo">Mineral Watch</a>
                <nav class="nav-links">
                    <a href="/portal">Dashboard</a>
                    <a href="/portal/map">Map</a>
                    <a href="/portal/intelligence" class="active">Intelligence</a>
                    <a href="/portal/account">Account</a>
                    <a href="/portal/learn">Learn</a>
                </nav>
                <div class="user-menu">
                    <span class="user-name" id="userName">Loading...</span>
                    <button class="btn-logout" id="logoutBtn">Log Out</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <div class="operators-hero">
        <div class="container">
            <div class="hero-content">
                <div class="hero-text">
                    <h1>Operator Directory</h1>
                    <p class="hero-subtitle">Research Oklahoma operators by deduction ratios and NGL recovery metrics</p>
                </div>
                <div class="hero-stats" id="heroStats">
                    <div class="hero-stat">
                        <span class="stat-value" id="statOperatorCount">—</span>
                        <span class="stat-label">Operators</span>
                    </div>
                    <div class="hero-stat">
                        <span class="stat-value" id="statStatewideDed">—</span>
                        <span class="stat-label">Avg Deduction Rate</span>
                    </div>
                    <div class="hero-stat">
                        <span class="stat-value" id="statStatewideNGL">—</span>
                        <span class="stat-label">Avg NGL Recovery</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main>
        <div class="container">
            <!-- Search and Filters -->
            <div class="search-section">
                <div class="search-box">
                    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="searchInput" placeholder="Search by operator name..." autocomplete="off">
                </div>
                <div class="filter-controls">
                    <div class="filter-group">
                        <label>Sort by</label>
                        <select id="sortSelect">
                            <option value="well_count">Most Wells</option>
                            <option value="deduction_ratio">Highest Deductions</option>
                            <option value="ngl_recovery">Lowest NGL Recovery</option>
                            <option value="name">Name (A-Z)</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Min. Wells</label>
                        <select id="minWellsSelect">
                            <option value="5">5+</option>
                            <option value="10">10+</option>
                            <option value="20" selected>20+</option>
                            <option value="50">50+</option>
                            <option value="100">100+</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Results Info -->
            <div class="results-info" id="resultsInfo">
                <span id="resultCount">Loading operators...</span>
            </div>

            <!-- Operator Table -->
            <div class="operators-table-container">
                <table class="operators-table" id="operatorsTable">
                    <thead>
                        <tr>
                            <th class="col-name">Operator</th>
                            <th class="col-wells">Wells</th>
                            <th class="col-gross">6-Mo Gross</th>
                            <th class="col-deduction">Deduction Ratio</th>
                            <th class="col-ngl">NGL Recovery</th>
                            <th class="col-actions"></th>
                        </tr>
                    </thead>
                    <tbody id="operatorsTableBody">
                        <tr class="loading-row">
                            <td colspan="6">
                                <div class="loading-spinner"></div>
                                <span>Loading operators...</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination" style="display: none;">
                <button class="btn btn-secondary" id="prevBtn" disabled>Previous</button>
                <span class="page-info" id="pageInfo">Page 1</span>
                <button class="btn btn-secondary" id="nextBtn">Next</button>
            </div>

            <!-- Methodology Note -->
            <div class="methodology-note">
                <h3>About These Metrics</h3>
                <div class="metric-explanations">
                    <div class="metric-item">
                        <strong>Deduction Ratio</strong>
                        <p>Percentage of gross production value taken as deductions. Calculated as: (Residue Gas Deductions) / (Total Gross Value) x 100. Higher values mean more is deducted before you receive payment.</p>
                    </div>
                    <div class="metric-item">
                        <strong>NGL Recovery</strong>
                        <p>Measures how much liquid value is returned relative to gas deductions. Calculated as: (NGL + Casinghead Value) / (Residue Gas Deductions) x 100. Higher values indicate more value returned to mineral owners through processed liquids.</p>
                    </div>
                </div>
                <p class="methodology-disclaimer">Data sourced from Oklahoma Tax Commission production records. Metrics reflect the past 6 months of reported production across all wells operated by each company. These are aggregate statistics and may not reflect individual well performance.</p>
            </div>
        </div>
    </main>

    <!-- Operator Detail Modal -->
    <div class="modal-overlay" id="operatorModal" style="display: none;">
        <div class="modal-content" style="overflow: hidden; display: flex; flex-direction: column;">
            <div class="modal-header operator-header" id="operatorModalHeader" style="background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%); color: white; padding: 20px 24px; position: relative; flex-shrink: 0; flex-direction: column; align-items: flex-start;">
                <button class="modal-close" onclick="closeOperatorModal()" style="position: absolute; top: 16px; right: 16px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.25); color: white; width: 32px; height: 32px; border-radius: 6px; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center;">&times;</button>
                <h2 id="modalOperatorName" style="margin: 0; font-size: 1.25rem; font-weight: 700; color: white; padding-right: 40px;">Operator Details</h2>
                <div id="modalOperatorMeta" style="display: flex; align-items: center; gap: 8px; margin-top: 6px; flex-wrap: wrap;"></div>
            </div>
            <div class="modal-body" id="modalBody" style="flex: 1; overflow-y: auto; min-height: 0;">
                <div class="loading-spinner"></div>
                <span>Loading details...</span>
            </div>
            <div class="modal-footer" id="operatorModalFooter" style="display: none; padding: 12px 24px; border-top: 1px solid #e5e7eb; flex-shrink: 0; background: white;">
                <div style="display: flex; gap: 8px; justify-content: flex-end;"></div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
/* __OPERATORS_JS__ */
    </script>
</body>
</html>
