<!-- BULK UPLOAD MODAL - REDESIGNED -->
<div class="modal-overlay" id="bulk-upload-modal">
    <div class="modal bulk-modal">
        <!-- Header -->
        <div class="bulk-header">
            <h2>Bulk Upload Properties</h2>
            <button class="bulk-close" onclick="closeBulkUploadModal()">&times;</button>
        </div>
        
        <!-- Step 1: File Upload -->
        <div id="upload-step" style="display:block;">
            <!-- Instructions -->
            <div class="bulk-section">
                <p class="bulk-intro">Upload a CSV or Excel file with your properties. We'll automatically detect columns and format your data.</p>
                <p class="bulk-text" style="margin-top: 8px;">ðŸ’¡ <strong>Tip:</strong> Include a Notes column to add context like well names, ownership details, or reminders for each property.</p>
            </div>
            
            <!-- File Formats -->
            <div class="bulk-section bulk-section-gray">
                <div class="bulk-label">Supported File Formats</div>
                <div class="bulk-text">CSV (.csv), Excel (.xlsx, .xls), Tab-delimited (.txt, .tsv)</div>
            </div>
            
            <!-- Two Column: Column Names + Format Examples -->
            <div class="bulk-section">
                <div class="bulk-two-col">
                    <!-- Column Names -->
                    <div>
                        <div class="bulk-label">Column Names (Flexible)</div>
                        <div class="bulk-columns">
                            <div><strong>Section:</strong> <code>SEC</code> <code>Section</code> <code>Sec</code> <code>S</code></div>
                            <div><strong>Township:</strong> <code>TWN</code> <code>Township</code> <code>Town</code> <code>T</code></div>
                            <div><strong>Range:</strong> <code>RNG</code> <code>Range</code> <code>R</code></div>
                            <div><strong>Notes:</strong> <code>Notes</code> <code>Note</code> <code>Comments</code></div>
                            <div><strong>Acres:</strong> <code>RI Acres</code> <code>RI</code> <code>WI Acres</code> <code>WI</code> <code>Total Acres</code> <code>Acres</code></div>
                            <div><strong>Group:</strong> <code>Group</code> <code>Entity</code></div>
                            <div><strong>Optional:</strong> County, Meridian, Group, RI Acres, WI Acres, Total Acres</div>
                            <div style="font-size: 12px; color: var(--slate-blue); margin-top: 8px;">ðŸ’¡ If only "Total Acres" is provided, it defaults to RI interest</div>
                        </div>
                    </div>
                    
                    <!-- Format Examples -->
                    <div>
                        <div class="bulk-label">We Auto-Format These</div>
                        <div class="bulk-formats">
                            <div class="bulk-format"><code>3</code> <span class="arrow">â†’</span> <code>03</code></div>
                            <div class="bulk-format"><code>S3</code> <span class="arrow">â†’</span> <code>03</code></div>
                            <div class="bulk-format"><code>12 N</code> <span class="arrow">â†’</span> <code>12N</code></div>
                            <div class="bulk-format"><code>T12N</code> <span class="arrow">â†’</span> <code>12N</code></div>
                            <div class="bulk-format"><code>8W</code> <span class="arrow">â†’</span> <code>8W</code></div>
                            <div class="bulk-format"><code>R08W</code> <span class="arrow">â†’</span> <code>8W</code></div>
                        </div>
                        <p class="bulk-note">Missing meridian: Panhandle counties (Cimarron, Texas, Beaver) default to CM, all others to IM</p>
                    </div>
                </div>
            </div>
            
            <!-- Upload Area -->
            <div class="bulk-section">
                <div class="bulk-dropzone" id="dropzone" 
                     ondrop="handleFileDrop(event)" 
                     ondragover="handleDragOver(event)"
                     ondragleave="handleDragLeave(event)"
                     onclick="document.getElementById('fileInput').click()">
                    <div class="dropzone-icon">ðŸ“„</div>
                    <div class="dropzone-text">Drop your file here or click to browse</div>
                    <div class="dropzone-subtext">Maximum file size: 5MB</div>
                </div>
                
                <input type="file" id="fileInput" accept=".csv,.xlsx,.xls,.txt,.tsv" style="display:none;" onchange="handleFileSelect(event)">
                
                <div id="file-info" class="bulk-file-info" style="display: none;">
                    <span class="file-name" id="filename"></span>
                    <span class="file-size" id="filesize"></span>
                </div>
                
                <div id="parse-error" class="bulk-error" style="display: none;">
                    <strong>Error parsing file:</strong> <span id="error-message"></span>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="bulk-footer">
                <button class="btn-secondary" onclick="closeBulkUploadModal()">Cancel</button>
            </div>
        </div>
        
        <!-- Step 2: Preview & Validate -->
        <div id="preview-step" style="display:none;">
            <div class="bulk-section">
                <h3 style="margin-bottom: 8px; font-family: 'Merriweather', serif;">Preview & Validate</h3>
                <p class="bulk-text">Review the detected properties before importing:</p>
            </div>
            
            <div class="bulk-section">
                <!-- Validation Badges -->
                <div id="validation-summary" class="bulk-badges"></div>
                
                <!-- Plan Check -->
                <div id="plan-check"></div>
                
                <!-- Preview Table -->
                <div class="bulk-table-container">
                    <table class="bulk-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>SEC</th>
                                <th>TWN</th>
                                <th>RNG</th>
                                <th>MER</th>
                                <th>County</th>
                                <th>Group</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="preview-table-body"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="bulk-footer">
                <button class="btn-secondary" onclick="resetBulkUpload()">Start Over</button>
                <button id="import-btn" class="btn-primary" onclick="startImport()">Import Properties</button>
            </div>
        </div>
        
        <!-- Step 3: Importing Progress -->
        <div id="import-step" style="display:none;">
            <div class="bulk-progress">
                <div class="progress-icon">âš¡</div>
                <h3>Importing Properties...</h3>
                <p class="bulk-text">Please wait while we create your properties.</p>
                <div class="progress-bar-track">
                    <div class="progress-bar-fill" id="progress-bar"></div>
                </div>
                <div class="progress-percent" id="progress-percent">0%</div>
                <div class="progress-count" id="import-progress">0 of 0 properties created</div>
            </div>
        </div>
        
        <!-- Step 4: Results -->
        <div id="results-step" style="display:none;">
            <div class="bulk-results">
                <div class="results-icon" id="results-icon">âœ…</div>
                <h3 class="results-title" id="results-title">Import Complete!</h3>
                <div class="results-stats">
                    <div class="stat-box">
                        <div class="stat-number stat-success" id="result-created">0</div>
                        <div class="stat-label">Created</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number stat-warning" id="result-skipped">0</div>
                        <div class="stat-label">Skipped</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number stat-error" id="result-failed">0</div>
                        <div class="stat-label">Failed</div>
                    </div>
                </div>
                <p class="bulk-text" id="results-details">Your properties are now being monitored for OCC activity.</p>
                <button class="btn-primary" onclick="finishBulkUpload()">Done</button>
            </div>
        </div>
    </div>
</div>

