name = "portal-worker"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Static assets - use public directory
[assets]
directory = "./public"

[[kv_namespaces]]
binding = "AUTH_TOKENS"
id = "77f5c8c49d4a4743bcf9f9d2140c0f2c"

[[kv_namespaces]]
binding = "OCC_CACHE"
id = "0988b6413183413bb4f1d1731ced4ed8"

[[kv_namespaces]]
binding = "COMPLETIONS_CACHE"
id = "d39109ffa98d4f4d999ee37098d0c13e"

# Service binding to auth-worker
[[services]]
binding = "AUTH_WORKER"
service = "auth-worker"

# Service binding to documents-worker
[[services]]
binding = "DOCUMENTS_WORKER"
service = "documents-worker"

# Service binding to occ-fetcher
[[services]]
binding = "OCC_FETCHER"
service = "occ-fetcher"

# D1 Database for Oklahoma Wells
[[d1_databases]]
binding = "WELLS_DB"
database_name = "oklahoma-wells"
database_id = "9afdff90-6719-46dd-97d2-6ca3777b17c9"

# Environment variables (secrets set via CLI)
# MINERAL_AIRTABLE_API_KEY = "your-airtable-api-key"
# RESEND_API_KEY = "your-resend-api-key"
# AUTH_SECRET = "your-auth-secret"
# STRIPE_SECRET_KEY = "your-stripe-secret-key"
# SYNC_API_KEY = "your-sync-api-key"

[vars]
PROCESSING_API_KEY = "mmw-proc-2024-secure-key"
OKCR_API_BASE = "https://okcountyrecords.com/api/v1"

[triggers]
crons = [
  "*/15 * * * *",      # Every 15 minutes - Airtable sync
  "0 8 * * *"          # Daily - OTC production data sync via Fly machine
]
