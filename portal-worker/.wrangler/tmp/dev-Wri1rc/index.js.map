{
  "version": 3,
  "sources": ["../bundle-PKh0lS/checked-fetch.js", "../../../src/constants.ts", "../../../src/utils/responses.ts", "../../../src/templates/index.ts", "../../../src/services/airtable.ts", "../../../src/utils/auth.ts", "../../../src/services/postmark.ts", "../../../src/handlers/activity.ts", "../../../src/handlers/properties.ts", "../../../src/handlers/wells.ts", "../../../src/handlers/auth.ts", "../../../src/handlers/billing.ts", "../../../src/handlers/bulk.ts", "../../../src/handlers/track-well.ts", "../../../index.js", "../../../../../../.npm-global/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../../.npm-global/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-PKh0lS/middleware-insertion-facade.js", "../../../../../../.npm-global/lib/node_modules/wrangler/templates/middleware/common.ts", "../bundle-PKh0lS/middleware-loader.entry.ts"],
  "sourceRoot": "/Users/jamesprice/mymineralwatch/mineral-watch-site/portal-worker/.wrangler/tmp/dev-Wri1rc",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "/**\n * Portal Worker Constants\n * \n * Centralized constants for the Mineral Watch Portal Worker\n */\n\n// Authentication & Session Constants\nexport const COOKIE_NAME = \"mw_session\";\nexport const TOKEN_EXPIRY = 15 * 60 * 1000; // 15 minutes\nexport const SESSION_EXPIRY = 30 * 24 * 60 * 60 * 1000; // 30 days\n\n// Airtable Configuration\nexport const BASE_ID = \"app3j3X29Uvp5stza\";\nexport const USERS_TABLE = \"\uD83D\uDC64 Users\";\nexport const PROPERTIES_TABLE = \"\uD83D\uDCCD Client Properties\";\nexport const WELLS_TABLE = \"\uD83D\uDEE2\uFE0F Client Wells\";\nexport const ACTIVITY_TABLE = \"\uD83D\uDCCB Activity Log\";\n\n// Application URLs\nexport const BASE_URL = \"https://portal.mymineralwatch.com\";\n\n// Plan Limits Configuration\nexport const PLAN_LIMITS = {\n  \"Free\": { properties: 1, wells: 1 },\n  \"Starter\": { properties: 10, wells: 10 },\n  \"Standard\": { properties: 50, wells: 50 },\n  \"Professional\": { properties: 250, wells: 250 },\n  \"Enterprise\": { properties: Infinity, wells: Infinity }\n} as const;\n\n// Plan-based activity history limits (in days)\nexport const ACTIVITY_LIMITS = {\n  \"Free\": 7,\n  \"Starter\": 30,\n  \"Standard\": 90,\n  \"Professional\": 365 * 10,  // 10 years = essentially unlimited\n  \"Enterprise\": 365 * 10\n} as const;\n\n// Cache TTL\nexport const OCC_CACHE_TTL = 86400; // 24 hours in seconds\n\n// Validation Limits\nexport const MAX_NOTES_LENGTH = 1000;\n\n// CORS Headers\nexport const CORS_HEADERS = {\n  \"Access-Control-Allow-Origin\": \"*\",\n  \"Access-Control-Allow-Methods\": \"GET, POST, DELETE, OPTIONS\",\n  \"Access-Control-Allow-Headers\": \"Content-Type\"\n} as const;\n\n// Stripe Price IDs - NEW pricing\nexport const PRICE_IDS = {\n  starter_monthly: 'price_1SXDS9641UqM8A7NeSc0MOTv',    // $9/mo\n  starter_annual: 'price_1SXDSG641UqM8A7N9PbCLsvG',     // $86/yr\n  standard_monthly: 'price_1SXDSL641UqM8A7NSS10CWBd',   // $29/mo\n  standard_annual: 'price_1SXDSQ641UqM8A7NIWcuCzmp',    // $278/yr\n  professional_monthly: 'price_1SXDSV641UqM8A7NZTXdvUls', // $99/mo\n  professional_annual: 'price_1SXDSZ641UqM8A7NvTHEJy9s'   // $950/yr\n} as const;\n\n// Map price ID to plan name\nexport const PRICE_TO_PLAN = {\n  [PRICE_IDS.starter_monthly]: 'Starter',\n  [PRICE_IDS.starter_annual]: 'Starter',\n  [PRICE_IDS.standard_monthly]: 'Standard',\n  [PRICE_IDS.standard_annual]: 'Standard',\n  [PRICE_IDS.professional_monthly]: 'Professional',\n  [PRICE_IDS.professional_annual]: 'Professional'\n} as const;", "/**\n * Response Utilities\n * \n * Common response helpers and utilities for the Portal Worker\n */\n\nimport { CORS_HEADERS } from '../constants.js';\n\n/**\n * Create a JSON response with CORS headers\n * @param data The data to return as JSON\n * @param status HTTP status code (default: 200)\n * @returns Response object with JSON content type and CORS headers\n */\nexport function jsonResponse(data: any, status = 200): Response {\n  return new Response(JSON.stringify(data), {\n    status,\n    headers: { \"Content-Type\": \"application/json\", ...CORS_HEADERS }\n  });\n}\n\n/**\n * Serve an HTML page\n * @param html The HTML content to serve\n * @param request The incoming request (for potential future use)\n * @param env The environment bindings (for potential future use)\n * @returns Response object with HTML content type\n */\nexport function servePage(html: string, request?: Request, env?: any): Response {\n  return new Response(html, {\n    headers: { \"Content-Type\": \"text/html; charset=utf-8\" }\n  });\n}\n\n/**\n * Create a redirect response with an error message\n * @param message The error message to include in query params\n * @returns 302 redirect response to login page with error\n */\nexport function redirectWithError(message: string): Response {\n  const params = new URLSearchParams({ error: message });\n  return new Response(null, {\n    status: 302,\n    headers: { \"Location\": `/portal/login?${params}` }\n  });\n}\n\n/**\n * Create a simple 404 Not Found response\n * @returns 404 response\n */\nexport function notFoundResponse(): Response {\n  return new Response(\"Not Found\", { status: 404 });\n}\n\n/**\n * Create a CORS preflight response\n * @returns Response with CORS headers for OPTIONS requests\n */\nexport function corsResponse(): Response {\n  return new Response(null, { headers: CORS_HEADERS });\n}\n\n/**\n * Create an error response\n * @param message Error message\n * @param status HTTP status code (default: 500)\n * @returns JSON error response\n */\nexport function errorResponse(message: string, status = 500): Response {\n  return jsonResponse({ error: message }, status);\n}", "/**\n * Template Exports\n * \n * Centralized exports for all HTML templates used in the Portal Worker\n */\n\nimport dashboardHtml from './dashboard.html';\nimport loginHtml from './login.html';\nimport accountHtml from './account.html';\nimport upgradeHtml from './upgrade.html';\n\nexport { dashboardHtml, loginHtml, accountHtml, upgradeHtml };", "/**\n * Airtable Service\n * \n * Handles all Airtable API interactions for the Portal Worker\n * Provides functions for user management, property tracking, and well monitoring\n */\n\nimport { \n  BASE_ID, \n  USERS_TABLE, \n  PROPERTIES_TABLE, \n  WELLS_TABLE \n} from '../constants.js';\n\nimport type { Env } from '../types/env.js';\n\n/**\n * Enhanced type definitions for Airtable records\n */\nexport interface AirtableUser {\n  id: string;\n  fields: {\n    Email: string;\n    Name?: string;\n    Plan?: string;\n  };\n}\n\nexport interface AirtableProperty {\n  id: string;\n  fields: {\n    SEC: string;\n    TWN: string;\n    RNG: string;\n    MERIDIAN?: string;\n    COUNTY?: string;\n    User?: string[];\n    'User Email'?: string;\n  };\n}\n\nexport interface AirtableWell {\n  id: string;\n  fields: {\n    'API Number': string;\n    'Well Name'?: string;\n    User?: string[];\n  };\n}\n\nexport interface SimplifiedProperty {\n  SEC: string;\n  TWN: string;\n  RNG: string;\n  MERIDIAN: string;\n}\n\nexport interface SimplifiedWell {\n  id: string;\n  apiNumber: string;\n  wellName: string;\n}\n\n/**\n * Find a user by their email address\n * @param env Worker environment\n * @param email User's email address\n * @returns User record or null if not found\n */\nexport async function findUserByEmail(env: Env, email: string): Promise<AirtableUser | null> {\n  const formula = `LOWER({Email}) = '${email.toLowerCase()}'`;\n  const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(USERS_TABLE)}?filterByFormula=${encodeURIComponent(formula)}&maxRecords=1`;\n  const response = await fetch(url, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  if (!response.ok) throw new Error(`Airtable error: ${response.status}`);\n  const data = await response.json();\n  return data.records?.[0] || null;\n}\n\n/**\n * Get a user by their Airtable record ID\n * @param env Worker environment\n * @param userId Airtable user record ID\n * @returns User object or null if not found\n */\nexport async function getUserById(env: Env, userId: string): Promise<AirtableUser | null> {\n  const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(USERS_TABLE)}/${userId}`;\n  const response = await fetch(url, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  if (!response.ok) return null;\n  return await response.json();\n}\n\n/**\n * Count the number of properties for a user\n * @param env Worker environment\n * @param userEmail User's email address\n * @returns Number of properties\n */\nexport async function countUserProperties(env: Env, userEmail: string): Promise<number> {\n  const formula = `FIND('${userEmail}', ARRAYJOIN({User})) > 0`;\n  const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(PROPERTIES_TABLE)}?filterByFormula=${encodeURIComponent(formula)}&fields[]=SEC`;\n  const response = await fetch(url, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  if (!response.ok) return 0;\n  const data = await response.json();\n  return data.records?.length || 0;\n}\n\n/**\n * Count the number of wells for a user\n * @param env Worker environment\n * @param userEmail User's email address\n * @returns Number of wells\n */\nexport async function countUserWells(env: Env, userEmail: string): Promise<number> {\n  const formula = `FIND('${userEmail}', ARRAYJOIN({User})) > 0`;\n  const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(WELLS_TABLE)}?filterByFormula=${encodeURIComponent(formula)}&fields[]=API Number`;\n  const response = await fetch(url, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  if (!response.ok) return 0;\n  const data = await response.json();\n  return data.records?.length || 0;\n}\n\n/**\n * Check if a property is already tracked by a user (duplicate detection)\n * @param env Worker environment\n * @param userEmail User's email address\n * @param county County name\n * @param section Section number\n * @param township Township\n * @param range Range\n * @returns True if duplicate exists, false otherwise\n */\nexport async function checkDuplicateProperty(env: Env, userEmail: string, county: string, section: string, township: string, range: string): Promise<boolean> {\n  const formula = `AND(FIND('${userEmail}', ARRAYJOIN({User})) > 0, {COUNTY} = '${county}', {SEC} = '${section}', {TWN} = '${township}', {RNG} = '${range}')`;\n  const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(PROPERTIES_TABLE)}?filterByFormula=${encodeURIComponent(formula)}&maxRecords=1`;\n  const response = await fetch(url, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  if (!response.ok) return false;\n  const data = await response.json();\n  return data.records?.length > 0;\n}\n\n/**\n * Check if a well is already tracked by a user (duplicate detection)\n * @param env Worker environment\n * @param userEmail User's email address\n * @param apiNumber Well API number\n * @returns True if duplicate exists, false otherwise\n */\nexport async function checkDuplicateWell(env: Env, userEmail: string, apiNumber: string): Promise<boolean> {\n  const formula = `AND(FIND('${userEmail}', ARRAYJOIN({User})) > 0, {API Number} = '${apiNumber}')`;\n  const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(WELLS_TABLE)}?filterByFormula=${encodeURIComponent(formula)}&maxRecords=1`;\n  const response = await fetch(url, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  if (!response.ok) return false;\n  const data = await response.json();\n  return data.records?.length > 0;\n}\n\n/**\n * Fetch all records from an Airtable table with pagination support\n * @param env Worker environment\n * @param table Table name\n * @param formula Filter formula\n * @returns Array of all matching records\n */\nexport async function fetchAllAirtableRecords(env: Env, table: string, formula: string): Promise<any[]> {\n  let allRecords: any[] = [];\n  let offset: string | null = null;\n  \n  do {\n    let url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(table)}?filterByFormula=${encodeURIComponent(formula)}`;\n    if (offset) {\n      url += `&offset=${offset}`;\n    }\n    \n    const response = await fetch(url, {\n      headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n    });\n    \n    if (!response.ok) {\n      const errText = await response.text();\n      console.error(`Airtable fetch error for ${table}:`, errText);\n      throw new Error(`Airtable error: ${response.status}`);\n    }\n    \n    const data = await response.json();\n    allRecords = allRecords.concat(data.records);\n    offset = data.offset; // Will be undefined when no more pages\n    \n  } while (offset);\n  \n  return allRecords;\n}\n\n/**\n * Fetch all properties for a user\n * @param env Worker environment\n * @param userEmail User's email address\n * @returns Array of simplified property objects\n */\nexport async function fetchUserProperties(env: Env, userEmail: string): Promise<SimplifiedProperty[]> {\n  const user = await findUserByEmail(env, userEmail);\n  if (!user) return [];\n  \n  const formula = `{User Email} = \"${userEmail}\"`;\n  const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(PROPERTIES_TABLE)}?filterByFormula=${encodeURIComponent(formula)}`;\n  \n  const response = await fetch(url, {\n    headers: {\n      Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}`\n    }\n  });\n  \n  if (!response.ok) return [];\n  \n  const data = await response.json();\n  return data.records.map((r: AirtableProperty) => ({\n    SEC: r.fields.SEC,\n    TWN: r.fields.TWN,\n    RNG: r.fields.RNG,\n    MERIDIAN: r.fields.MERIDIAN || 'IM'\n  }));\n}\n\n/**\n * Fetch all wells for a user\n * @param env Worker environment\n * @param userEmail User's email address\n * @returns Array of simplified well objects\n */\nexport async function fetchUserWells(env: Env, userEmail: string): Promise<SimplifiedWell[]> {\n  const user = await findUserByEmail(env, userEmail);\n  if (!user) return [];\n  \n  const formula = `FIND('${userEmail}', ARRAYJOIN({User})) > 0`;\n  const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(WELLS_TABLE)}?filterByFormula=${encodeURIComponent(formula)}`;\n  \n  const response = await fetch(url, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  \n  if (!response.ok) return [];\n  \n  const data = await response.json();\n  return data.records.map((r: AirtableWell) => ({\n    id: r.id,\n    apiNumber: r.fields[\"API Number\"] || '',\n    wellName: r.fields[\"Well Name\"] || ''\n  }));\n}", "/**\n * Authentication Utilities\n * \n * Handles session management, token generation/verification, and cookie parsing\n * for the Portal Worker authentication system\n */\n\nimport { COOKIE_NAME } from '../constants.js';\nimport type { Env } from '../types/env.js';\n\n/**\n * Session payload interface\n */\nexport interface SessionPayload {\n  id: string;\n  email: string;\n  name?: string;\n  exp: number;\n}\n\n/**\n * Parse a cookie value from a cookie string\n * @param cookieString The full cookie header value\n * @param name The cookie name to extract\n * @returns Cookie value or null if not found\n */\nexport function getCookieValue(cookieString: string, name: string): string | null {\n  const match = cookieString.match(new RegExp(`(^| )${name}=([^;]+)`));\n  return match ? match[2] : null;\n}\n\n/**\n * Authenticate a request by verifying the session cookie\n * @param request The incoming request\n * @param env Worker environment\n * @returns User session payload or null if not authenticated\n */\nexport async function authenticateRequest(request: Request, env: Env): Promise<SessionPayload | null> {\n  const cookie = request.headers.get(\"Cookie\") || \"\";\n  const sessionToken = getCookieValue(cookie, COOKIE_NAME);\n  if (!sessionToken) return null;\n  \n  try {\n    const payload = await verifySession(env, sessionToken);\n    if (Date.now() > payload.exp) return null;\n    return payload;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Generate a new token and store it in KV with expiration\n * @param env Worker environment\n * @param payload Data to store with the token\n * @param ttlSeconds Time to live in seconds (default: 900 = 15 minutes)\n * @returns Generated token ID\n */\nexport async function generateToken(env: Env, payload: any, ttlSeconds: number = 900): Promise<string> {\n  const tokenId = crypto.randomUUID();\n  await env.AUTH_TOKENS.put(tokenId, JSON.stringify(payload), {\n    expirationTtl: ttlSeconds\n  });\n  return tokenId;\n}\n\n/**\n * Verify and consume a one-time token (deletes after verification)\n * @param env Worker environment\n * @param token Token to verify\n * @returns Stored payload data\n * @throws Error if token not found or expired\n */\nexport async function verifyToken(env: Env, token: string): Promise<any> {\n  const data = await env.AUTH_TOKENS.get(token, \"json\");\n  if (!data) throw new Error(\"Token not found or expired\");\n  await env.AUTH_TOKENS.delete(token);\n  return data;\n}\n\n/**\n * Verify a session token without consuming it (for repeated checks)\n * @param env Worker environment  \n * @param token Session token to verify\n * @returns Session payload data\n * @throws Error if session not found or expired\n */\nexport async function verifySession(env: Env, token: string): Promise<SessionPayload> {\n  const data = await env.AUTH_TOKENS.get(token, \"json\");\n  if (!data) throw new Error(\"Session not found or expired\");\n  return data;\n}", "/**\n * Postmark Email Service\n * \n * Handles all email sending functionality for the Portal Worker\n * Includes magic link emails, welcome emails, and template generation\n */\n\nimport type { Env } from '../types/env.js';\n\n/**\n * Send a magic link email for user login\n * @param env Worker environment\n * @param email User's email address\n * @param name User's display name\n * @param magicLink The magic login link\n * @returns Promise that resolves when email is sent\n */\nexport async function sendMagicLinkEmail(env: Env, email: string, name: string, magicLink: string): Promise<void> {\n  const response = await fetch(\"https://api.postmarkapp.com/email\", {\n    method: \"POST\",\n    headers: {\n      \"Accept\": \"application/json\",\n      \"Content-Type\": \"application/json\",\n      \"X-Postmark-Server-Token\": env.POSTMARK_API_KEY\n    },\n    body: JSON.stringify({\n      From: \"support@mymineralwatch.com\",\n      To: email,\n      Subject: \"Your Mineral Watch Login Link\",\n      HtmlBody: `\n        <div style=\"font-family: sans-serif; max-width: 500px; margin: 0 auto;\">\n          <h2 style=\"color: #1C2B36;\">Log in to Mineral Watch</h2>\n          <p style=\"color: #334E68;\">Hi ${name},</p>\n          <p style=\"color: #334E68;\">Click below to log in. This link expires in 15 minutes.</p>\n          <div style=\"margin: 30px 0;\">\n            <a href=\"${magicLink}\" style=\"background-color: #C05621; color: white; padding: 14px 28px; text-decoration: none; border-radius: 4px; font-weight: 600;\">Log In to Mineral Watch</a>\n          </div>\n          <p style=\"color: #718096; font-size: 14px;\">If you didn't request this, you can ignore this email.</p>\n          <hr style=\"border: none; border-top: 1px solid #E2E8F0; margin: 30px 0;\">\n          <p style=\"color: #A0AEC0; font-size: 12px;\">Mineral Watch - Oklahoma Mineral Rights Monitoring</p>\n        </div>\n      `,\n      TextBody: `Hi ${name},\n\nClick this link to log in to Mineral Watch: ${magicLink}\n\nThis link expires in 15 minutes.\n\nIf you didn't request this, you can ignore this email.\n\n\u2014 Mineral Watch - Oklahoma Mineral Rights Monitoring`\n    })\n  });\n\n  if (!response.ok) {\n    const emailError = await response.text();\n    throw new Error(`Postmark email error: ${emailError}`);\n  }\n}\n\n/**\n * Send a welcome email to new users using Postmark\n * @param env Worker environment\n * @param email User's email address\n * @param name User's display name\n * @param magicLink The verification/login link\n * @returns Promise that resolves when email is sent\n */\nexport async function sendWelcomeEmail(env: Env, email: string, name: string, magicLink: string): Promise<void> {\n  const htmlBody = getFreeWelcomeEmailHtml(name, magicLink);\n  const textBody = getFreeWelcomeEmailText(name, magicLink);\n\n  const response = await fetch(\"https://api.postmarkapp.com/email\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"X-Postmark-Server-Token\": env.POSTMARK_API_KEY\n    },\n    body: JSON.stringify({\n      From: \"support@mymineralwatch.com\",\n      To: email,\n      Subject: \"Welcome to Mineral Watch - Verify Your Account\",\n      HtmlBody: htmlBody,\n      TextBody: textBody\n    })\n  });\n\n  if (!response.ok) {\n    const emailError = await response.text();\n    throw new Error(`Postmark email error: ${emailError}`);\n  }\n}\n\n/**\n * Generate HTML email template for free welcome email\n * @param name User's display name\n * @param magicLink The verification/login link\n * @returns HTML email content\n */\nexport function getFreeWelcomeEmailHtml(name: string, magicLink: string): string {\n  return `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n</head>\n<body style=\"margin: 0; padding: 0; background-color: #f7fafc; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\">\n  <div style=\"max-width: 600px; margin: 0 auto; padding: 40px 20px;\">\n    <div style=\"background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden;\">\n      \n      <!-- Header -->\n      <div style=\"background: #1C2B36; padding: 30px; text-align: center;\">\n        <h1 style=\"color: white; margin: 0; font-size: 24px; font-weight: 700;\">Mineral Watch</h1>\n      </div>\n      \n      <!-- Content -->\n      <div style=\"padding: 40px 30px;\">\n        <p style=\"font-size: 18px; color: #1C2B36; margin: 0 0 20px;\">Hi ${name},</p>\n        \n        <p style=\"font-size: 16px; color: #334E68; line-height: 1.6; margin: 0 0 25px;\">\n          Welcome to Mineral Watch! Your free account is ready.\n        </p>\n        \n        <!-- CTA Button -->\n        <div style=\"text-align: center; margin: 30px 0;\">\n          <a href=\"${magicLink}\" style=\"display: inline-block; background: #C05621; color: white; padding: 14px 32px; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 16px;\">Verify & Log In \u2192</a>\n        </div>\n        \n        <p style=\"text-align: center; font-size: 13px; color: #718096; margin: 0 0 30px;\">\n          This link expires in 15 minutes.\n        </p>\n        \n        <hr style=\"border: none; border-top: 1px solid #E2E8F0; margin: 30px 0;\">\n        \n        <!-- What You're Getting -->\n        <h2 style=\"color: #1C2B36; font-size: 18px; margin: 0 0 16px;\">What You're Getting</h2>\n        \n        <p style=\"font-size: 15px; color: #334E68; line-height: 1.6; margin: 0 0 20px;\">\n          Mineral Watch monitors Oklahoma Corporation Commission filings and alerts you when something happens on your minerals. Here's what makes us different:\n        </p>\n        \n        <!-- Feature: Watch the neighbors -->\n        <div style=\"margin-bottom: 20px;\">\n          <h3 style=\"color: #1C2B36; font-size: 15px; margin: 0 0 6px;\">We watch the neighbors</h3>\n          <p style=\"font-size: 14px; color: #334E68; line-height: 1.5; margin: 0;\">\n            Enter your property once and we automatically monitor your section PLUS the 8 surrounding sections. This catches horizontal wells headed your way\u2014not just activity in your exact section.\n          </p>\n        </div>\n        \n        <!-- Feature: Check daily -->\n        <div style=\"margin-bottom: 20px;\">\n          <h3 style=\"color: #1C2B36; font-size: 15px; margin: 0 0 6px;\">We check daily</h3>\n          <p style=\"font-size: 14px; color: #334E68; line-height: 1.5; margin: 0;\">\n            Every day we scan for new drilling permits, rigs on location, and well completions.\n          </p>\n        </div>\n        \n        <!-- Feature: Status changes -->\n        <div style=\"margin-bottom: 20px;\">\n          <h3 style=\"color: #1C2B36; font-size: 15px; margin: 0 0 6px;\">We track status changes</h3>\n          <p style=\"font-size: 14px; color: #334E68; line-height: 1.5; margin: 0;\">\n            Every week we check for changes like \"Shut-In,\" \"Plugged,\" or change of operator.\n          </p>\n        </div>\n        \n        <!-- Feature: Translate -->\n        <div style=\"margin-bottom: 20px;\">\n          <h3 style=\"color: #1C2B36; font-size: 15px; margin: 0 0 6px;\">We translate it</h3>\n          <p style=\"font-size: 14px; color: #334E68; line-height: 1.5; margin: 0;\">\n            No confusing OCC codes. You get plain English alerts like \"New Drilling Permit\" or \"Rig on Location.\"\n          </p>\n        </div>\n        \n        <!-- Feature: Every operator -->\n        <div style=\"margin-bottom: 20px;\">\n          <h3 style=\"color: #1C2B36; font-size: 15px; margin: 0 0 6px;\">We track every operator</h3>\n          <p style=\"font-size: 14px; color: #334E68; line-height: 1.5; margin: 0;\">\n            We scan the official state database, so we catch activity from everyone\u2014including small operators who don't show up in paid services.\n          </p>\n        </div>\n        \n        <!-- Feature: Set and forget -->\n        <div style=\"margin-bottom: 20px;\">\n          <h3 style=\"color: #1C2B36; font-size: 15px; margin: 0 0 6px;\">Set it and forget it</h3>\n          <p style=\"font-size: 14px; color: #334E68; line-height: 1.5; margin: 0;\">\n            You enter your legal description once. We handle the rest and only email you when something changes.\n          </p>\n        </div>\n        \n        <hr style=\"border: none; border-top: 1px solid #E2E8F0; margin: 30px 0;\">\n        \n        <!-- Your Free Plan -->\n        <div style=\"background: #F7FAFC; border-radius: 6px; padding: 20px; margin: 0 0 25px;\">\n          <h3 style=\"margin: 0 0 12px; color: #1C2B36; font-size: 16px;\">Your Free Plan</h3>\n          <ul style=\"margin: 0; padding: 0 0 0 20px; color: #334E68; line-height: 1.8; font-size: 14px;\">\n            <li>1 monitored property</li>\n            <li>Adjacent section monitoring included</li>\n            <li>Daily permit scans + weekly status checks</li>\n            <li>Plain English email alerts</li>\n          </ul>\n          <p style=\"font-size: 14px; color: #718096; margin: 16px 0 0;\">\n            Want to monitor more properties or track specific wells by API number? Upgrade anytime from your dashboard.\n          </p>\n        </div>\n        \n        <!-- What We Don't Do -->\n        <h3 style=\"color: #1C2B36; font-size: 16px; margin: 0 0 10px;\">What We Don't Do</h3>\n        <p style=\"font-size: 14px; color: #334E68; line-height: 1.5; margin: 0 0 25px;\">\n          We're focused on drilling activity and well status\u2014not revenue. We don't track pooling applications or royalty payments.\n        </p>\n        \n        <hr style=\"border: none; border-top: 1px solid #E2E8F0; margin: 30px 0;\">\n        \n        <!-- Getting Started -->\n        <h3 style=\"color: #1C2B36; font-size: 16px; margin: 0 0 12px;\">Getting Started</h3>\n        <p style=\"font-size: 14px; color: #334E68; line-height: 1.6; margin: 0 0 12px;\">\n          After you log in, add your first property. You'll need:\n        </p>\n        <ul style=\"margin: 0 0 20px; padding: 0 0 0 20px; color: #334E68; line-height: 1.8; font-size: 14px;\">\n          <li>County</li>\n          <li>Section (1-36)</li>\n          <li>Township (e.g., 12N)</li>\n          <li>Range (e.g., 4W)</li>\n        </ul>\n        <p style=\"font-size: 14px; color: #334E68; line-height: 1.5; margin: 0;\">\n          Paid plans also let you monitor individual wells by API number\u2014with a direct link to the well location on the OCC map.\n        </p>\n        \n        <hr style=\"border: none; border-top: 1px solid #E2E8F0; margin: 30px 0;\">\n        \n        <p style=\"font-size: 14px; color: #718096; margin: 0;\">\n          <strong>Questions?</strong> Just reply to this email.\n        </p>\n        \n        <p style=\"font-size: 16px; color: #334E68; margin: 30px 0 0;\">\n          \u2014 Mineral Watch\n        </p>\n      </div>\n      \n    </div>\n  </div>\n</body>\n</html>\n  `;\n}\n\n/**\n * Generate text email template for free welcome email\n * @param name User's display name\n * @param magicLink The verification/login link\n * @returns Plain text email content\n */\nexport function getFreeWelcomeEmailText(name: string, magicLink: string): string {\n  return `Hi ${name},\n\nWelcome to Mineral Watch! Your free account is ready.\n\nClick here to verify your email and log in:\n${magicLink}\n\nThis link expires in 15 minutes.\n\n----\n\nWHAT YOU'RE GETTING\n\nMineral Watch monitors Oklahoma Corporation Commission filings and alerts you when something happens on your minerals. Here's what makes us different:\n\nWE WATCH THE NEIGHBORS\nEnter your property once and we automatically monitor your section PLUS the 8 surrounding sections. This catches horizontal wells headed your way\u2014not just activity in your exact section.\n\nWE CHECK DAILY\nEvery day we scan for new drilling permits, rigs on location, and well completions.\n\nWE TRACK STATUS CHANGES\nEvery week we check for changes like \"Shut-In,\" \"Plugged,\" or change of operator.\n\nWE TRANSLATE IT\nNo confusing OCC codes. You get plain English alerts like \"New Drilling Permit\" or \"Rig on Location.\"\n\nWE TRACK EVERY OPERATOR\nWe scan the official state database, so we catch activity from everyone\u2014including small operators who don't show up in paid services.\n\nSET IT AND FORGET IT\nYou enter your legal description once. We handle the rest and only email you when something changes.\n\n----\n\nYOUR FREE PLAN\n- 1 monitored property\n- Adjacent section monitoring included\n- Daily permit scans + weekly status checks\n- Plain English email alerts\n\nWant to monitor more properties or track specific wells by API number? Upgrade anytime from your dashboard.\n\n----\n\nWHAT WE DON'T DO\n\nWe're focused on drilling activity and well status\u2014not revenue. We don't track pooling applications or royalty payments.\n\n----\n\nGETTING STARTED\n\nAfter you log in, add your first property. You'll need:\n- County\n- Section (1-36)  \n- Township (e.g., 12N)\n- Range (e.g., 4W)\n\nPaid plans also let you monitor individual wells by API number\u2014with a direct link to the well location on the OCC map.\n\n----\n\nQuestions? Just reply to this email.\n\n\u2014 Mineral Watch`;\n}", "/**\n * Activity Handlers\n * \n * Handles activity log listing and statistics for user accounts\n */\n\nimport { BASE_ID, ACTIVITY_TABLE, ACTIVITY_LIMITS } from '../constants.js';\nimport { jsonResponse } from '../utils/responses.js';\nimport { authenticateRequest } from '../utils/auth.js';\nimport type { Env } from '../types/env.js';\n\n/**\n * Handle activity log listing with plan-based date limits\n * @param request The incoming request\n * @param env Worker environment\n * @returns JSON response with activity records\n */\nexport async function handleListActivity(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  \n  // Get plan-based date limit\n  const daysLimit = ACTIVITY_LIMITS[user.plan] || 7;\n  const cutoffDate = new Date();\n  cutoffDate.setDate(cutoffDate.getDate() - daysLimit);\n  const cutoffISO = cutoffDate.toISOString();\n  \n  // Build formula: user's records, after cutoff date, sorted by date desc\n  const formula = `AND({Email} = '${user.email}', {Detected At} >= '${cutoffISO}')`;\n  \n  const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(ACTIVITY_TABLE)}?filterByFormula=${encodeURIComponent(formula)}&sort[0][field]=Detected At&sort[0][direction]=desc&maxRecords=100`;\n  \n  const response = await fetch(url, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  \n  if (!response.ok) {\n    const errText = await response.text();\n    console.error(\"Airtable list activity error:\", errText);\n    throw new Error(`Airtable error: ${response.status}`);\n  }\n  \n  const data = await response.json();\n  \n  // Include the limit info for the UI\n  return jsonResponse({\n    records: data.records,\n    daysLimit: daysLimit,\n    plan: user.plan\n  });\n}\n\n/**\n * Handle activity statistics calculation\n * @param request The incoming request\n * @param env Worker environment\n * @returns JSON response with activity statistics\n */\nexport async function handleActivityStats(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  \n  // Get all activity for this user (for stats, we count everything)\n  const formula = `{Email} = '${user.email}'`;\n  \n  const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(ACTIVITY_TABLE)}?filterByFormula=${encodeURIComponent(formula)}&sort[0][field]=Detected At&sort[0][direction]=desc`;\n  \n  const response = await fetch(url, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  \n  if (!response.ok) {\n    return jsonResponse({ lastAlert: null, thisMonth: 0, thisYear: 0, total: 0 });\n  }\n  \n  const data = await response.json();\n  const records = data.records || [];\n  \n  if (records.length === 0) {\n    return jsonResponse({ lastAlert: null, thisMonth: 0, thisYear: 0, total: 0 });\n  }\n  \n  const now = new Date();\n  const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n  const startOfYear = new Date(now.getFullYear(), 0, 1);\n  \n  let thisMonth = 0;\n  let thisYear = 0;\n  \n  records.forEach(r => {\n    const detectedAt = new Date(r.fields['Detected At']);\n    if (detectedAt >= startOfMonth) thisMonth++;\n    if (detectedAt >= startOfYear) thisYear++;\n  });\n  \n  // Last alert date\n  const lastAlertDate = records[0]?.fields['Detected At'] || null;\n  \n  return jsonResponse({\n    lastAlert: lastAlertDate,\n    thisMonth: thisMonth,\n    thisYear: thisYear,\n    total: records.length\n  });\n}", "/**\n * Properties Handlers\n * \n * Handles CRUD operations for user property monitoring\n */\n\nimport { \n  PROPERTIES_TABLE,\n  BASE_ID,\n  PLAN_LIMITS \n} from '../constants.js';\n\nimport { \n  jsonResponse \n} from '../utils/responses.js';\n\nimport {\n  getUserById,\n  countUserProperties,\n  checkDuplicateProperty,\n  fetchAllAirtableRecords\n} from '../services/airtable.js';\n\nimport {\n  authenticateRequest\n} from '../utils/auth.js';\n\nimport type { Env } from '../types/env.js';\n\n/**\n * List all properties for the authenticated user\n * @param request The incoming request\n * @param env Worker environment\n * @returns JSON response with user properties\n */\nexport async function handleListProperties(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  \n  const formula = `FIND('${user.email}', ARRAYJOIN({User})) > 0`;\n  const records = await fetchAllAirtableRecords(env, PROPERTIES_TABLE, formula);\n  \n  return jsonResponse(records);\n}\n\n/**\n * Add a new property for the authenticated user\n * @param request The incoming request with property data\n * @param env Worker environment\n * @returns JSON response with created property\n */\nexport async function handleAddProperty(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  const body = await request.json();\n  const required = [\"COUNTY\", \"SEC\", \"TWN\", \"RNG\"];\n  for (const field of required) {\n    if (!body[field]) {\n      return jsonResponse({ error: `${field} is required` }, 400);\n    }\n  }\n  const userRecord = await getUserById(env, user.id);\n  const plan = userRecord?.fields.Plan || \"Free\";\n  const planLimits = PLAN_LIMITS[plan] || { properties: 1, wells: 0 };\n  \n  // Count properties only (separate from wells limit)\n  const propertiesCount = await countUserProperties(env, user.email);\n  \n  if (propertiesCount >= planLimits.properties) {\n    return jsonResponse({ \n      error: `Property limit reached (${planLimits.properties} properties on ${plan} plan). You have ${propertiesCount} properties.` \n    }, 403);\n  }\n  \n  const section = String(body.SEC).padStart(2, \"0\");\n  const township = body.TWN.toUpperCase().replace(/\\s/g, \"\");\n  const range = body.RNG.toUpperCase().replace(/\\s/g, \"\");\n  const meridian = body.MERIDIAN || \"IM\";\n  const isDuplicate = await checkDuplicateProperty(env, user.email, body.COUNTY, section, township, range);\n  if (isDuplicate) {\n    return jsonResponse({ error: \"You are already monitoring this property.\" }, 409);\n  }\n  \n  // Generate OCC Map Link (placeholder - adjust as needed for section lookups)\n  const occMapLink = `https://occeweb.occ.ok.gov/PublicDocs/`;\n  \n  const createUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(PROPERTIES_TABLE)}`;\n  const response = await fetch(createUrl, {\n    method: \"POST\",\n    headers: {\n      Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}`,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      fields: {\n        User: [user.id],\n        COUNTY: body.COUNTY,\n        SEC: section,\n        TWN: township,\n        RNG: range,\n        MERIDIAN: meridian,\n        \"OCC Map Link\": occMapLink\n      }\n    })\n  });\n  if (!response.ok) {\n    const err = await response.text();\n    console.error(\"Airtable create error:\", err);\n    throw new Error(\"Failed to create property\");\n  }\n  const newRecord = await response.json();\n  console.log(`Property added: ${body.COUNTY} S${section} T${township} R${range} for ${user.email}`);\n  return jsonResponse(newRecord, 201);\n}\n\n/**\n * Update a property for the authenticated user\n * @param propertyId The property ID to update\n * @param request The incoming request with update data\n * @param env Worker environment\n * @returns JSON response with success status\n */\nexport async function handleUpdateProperty(propertyId: string, request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  \n  const body = await request.json();\n  \n  // Build fields object with allowed editable fields\n  const updateFields: Record<string, any> = {};\n  if (body.notes !== undefined) {\n    let notes = body.notes || \"\";\n    // Limit notes length to prevent abuse\n    if (notes.length > 1000) {\n      notes = notes.substring(0, 1000);\n    }\n    updateFields['Notes'] = notes;\n  }\n  if (body.meridian !== undefined) {\n    // Validate meridian value\n    if (!['IM', 'CM'].includes(body.meridian)) {\n      return jsonResponse({ error: 'Invalid meridian value' }, 400);\n    }\n    updateFields['MERIDIAN'] = body.meridian;\n  }\n  \n  // Verify ownership\n  const getUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(PROPERTIES_TABLE)}/${propertyId}`;\n  const getResponse = await fetch(getUrl, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  \n  if (!getResponse.ok) {\n    return jsonResponse({ error: \"Property not found\" }, 404);\n  }\n  \n  const property = await getResponse.json();\n  if (property.fields.User?.[0] !== user.id) {\n    return jsonResponse({ error: \"Not authorized\" }, 403);\n  }\n  \n  // Update property\n  const updateUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(PROPERTIES_TABLE)}/${propertyId}`;\n  const updateResponse = await fetch(updateUrl, {\n    method: \"PATCH\",\n    headers: {\n      Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}`,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({ fields: updateFields })\n  });\n  \n  if (!updateResponse.ok) {\n    return jsonResponse({ error: \"Failed to update property\" }, 500);\n  }\n  \n  return jsonResponse({ success: true });\n}\n\n/**\n * Delete a property for the authenticated user\n * @param propertyId The property ID to delete\n * @param request The incoming request\n * @param env Worker environment\n * @returns JSON response with success status\n */\nexport async function handleDeleteProperty(propertyId: string, request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  const getUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(PROPERTIES_TABLE)}/${propertyId}`;\n  const getResponse = await fetch(getUrl, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  if (!getResponse.ok) {\n    return jsonResponse({ error: \"Property not found\" }, 404);\n  }\n  const property = await getResponse.json();\n  if (property.fields.User?.[0] !== user.id) {\n    return jsonResponse({ error: \"Not authorized\" }, 403);\n  }\n  const deleteUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(PROPERTIES_TABLE)}/${propertyId}`;\n  await fetch(deleteUrl, {\n    method: \"DELETE\",\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  console.log(`Property deleted: ${propertyId} by ${user.email}`);\n  return jsonResponse({ success: true });\n}", "/**\n * Wells Handlers\n * \n * Handles CRUD operations for user well monitoring with OCC API integration\n */\n\nimport { \n  WELLS_TABLE,\n  BASE_ID,\n  PLAN_LIMITS,\n  OCC_CACHE_TTL\n} from '../constants.js';\n\nimport { \n  jsonResponse \n} from '../utils/responses.js';\n\nimport {\n  getUserById,\n  countUserWells,\n  checkDuplicateWell,\n  fetchAllAirtableRecords\n} from '../services/airtable.js';\n\nimport {\n  authenticateRequest\n} from '../utils/auth.js';\n\nimport type { Env } from '../types/env.js';\n\n/**\n * Generate OCC map link with coordinates and title\n * @param lat Latitude\n * @param lon Longitude  \n * @param title Map marker title\n * @returns OCC map URL with marker\n */\nfunction generateMapLink(lat: number, lon: number, title: string): string {\n  if (!lat || !lon) return \"#\"; \n  const appId = \"ba9b8612132f4106be6e3553dc0b827b\";\n  const markerTemplate = JSON.stringify({\n    title: title || \"Well Location\",\n    longitude: lon,\n    latitude: lat,\n    isIncludeShareUrl: true\n  });\n  return `https://gis.occ.ok.gov/portal/apps/webappviewer/index.html?id=${appId}&marker=${lon},${lat},,,,&markertemplate=${encodeURIComponent(markerTemplate)}&level=19`;\n}\n\n/**\n * Fetch well details from Oklahoma Corporation Commission API\n * @param apiNumber 10-digit API number\n * @param env Worker environment\n * @returns Well details or null if not found\n */\nexport async function fetchWellDetailsFromOCC(apiNumber: string, env: Env) {\n  // Check cache first\n  if (env?.OCC_CACHE) {\n    const cacheKey = `well_${apiNumber}`;\n    try {\n      const cached = await env.OCC_CACHE.get(cacheKey, 'json');\n      if (cached) {\n        console.log(`OCC cache hit: ${apiNumber}`);\n        return cached;\n      }\n    } catch (e) {\n      console.warn('OCC cache read error:', e);\n    }\n  }\n  \n  console.log(`OCC cache miss: ${apiNumber} - fetching from API`);\n  \n  const baseUrl = \"https://gis.occ.ok.gov/server/rest/services/Hosted/RBDMS_WELLS/FeatureServer/220/query\";\n  \n  const params = new URLSearchParams({\n    where: `api=${apiNumber}`,\n    outFields: \"api,well_name,well_num,operator,county,section,township,range,welltype,wellstatus,sh_lat,sh_lon\",\n    returnGeometry: \"false\",\n    f: \"json\",\n    resultRecordCount: \"1\"\n  });\n\n  try {\n    const response = await fetch(`${baseUrl}?${params.toString()}`, {\n      headers: { \"User-Agent\": \"MineralWatch-Portal/1.0\" }\n    });\n\n    if (!response.ok) {\n      console.error(`OCC API Error: ${response.status}`);\n      return null;\n    }\n\n    const data = await response.json();\n    \n    if (data.features && data.features.length > 0) {\n      const attr = data.features[0].attributes;\n      const wellDetails = {\n        api: attr.api,\n        wellName: attr.well_name && attr.well_num && !attr.well_name.includes('#') \n          ? `${attr.well_name} #${attr.well_num}` \n          : (attr.well_name || ''),\n        operator: attr.operator || null,\n        county: attr.county || null,\n        section: attr.section || null,\n        township: attr.township || null,\n        range: attr.range || null,\n        wellType: attr.welltype || null,\n        wellStatus: attr.wellstatus || null,\n        lat: attr.sh_lat,\n        lon: attr.sh_lon,\n        cachedAt: Date.now()\n      };\n      \n      // Cache the result\n      if (env?.OCC_CACHE) {\n        try {\n          await env.OCC_CACHE.put(\n            `well_${apiNumber}`, \n            JSON.stringify(wellDetails), \n            { expirationTtl: OCC_CACHE_TTL }\n          );\n          console.log(`OCC cached: ${apiNumber}`);\n        } catch (e) {\n          console.warn('OCC cache write error:', e);\n        }\n      }\n      \n      return wellDetails;\n    }\n    \n    return null;\n  } catch (error) {\n    console.error(\"Failed to fetch well from OCC:\", error);\n    return null;\n  }\n}\n\n/**\n * List all wells for the authenticated user\n * @param request The incoming request\n * @param env Worker environment\n * @returns JSON response with user wells\n */\nexport async function handleListWells(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  \n  const formula = `FIND('${user.email}', ARRAYJOIN({User})) > 0`;\n  const records = await fetchAllAirtableRecords(env, WELLS_TABLE, formula);\n  \n  return jsonResponse(records);\n}\n\n/**\n * Add a new well for the authenticated user with OCC validation\n * @param request The incoming request with well data\n * @param env Worker environment\n * @returns JSON response with created well\n */\nexport async function handleAddWell(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  const body = await request.json();\n  \n  // Validate API Number (required, 10 digits)\n  if (!body.apiNumber) {\n    return jsonResponse({ error: \"API Number is required\" }, 400);\n  }\n  \n  // Clean and validate API format (10 digits, Oklahoma format: 35-XXX-XXXXX)\n  const cleanApi = body.apiNumber.replace(/\\D/g, '');\n  if (cleanApi.length !== 10 || !cleanApi.startsWith('35')) {\n    return jsonResponse({ error: \"Invalid API format. Must be 10 digits starting with 35 (e.g., 3515322352)\" }, 400);\n  }\n  \n  const userRecord = await getUserById(env, user.id);\n  const plan = userRecord?.fields.Plan || \"Free\";\n  const planLimits = PLAN_LIMITS[plan] || { properties: 1, wells: 0 };\n  \n  // Check if plan allows wells\n  if (planLimits.wells === 0) {\n    return jsonResponse({ \n      error: `Your ${plan} plan does not include well monitoring. Please upgrade to add wells.` \n    }, 403);\n  }\n  \n  // Count wells only (separate from properties limit)\n  const wellsCount = await countUserWells(env, user.email);\n  \n  if (wellsCount >= planLimits.wells) {\n    return jsonResponse({ \n      error: `Well limit reached (${planLimits.wells} wells on ${plan} plan). You have ${wellsCount} wells.` \n    }, 403);\n  }\n  \n  // Check for duplicate well API for this user\n  const isDuplicate = await checkDuplicateWell(env, user.email, cleanApi);\n  if (isDuplicate) {\n    return jsonResponse({ error: \"You are already monitoring this well API.\" }, 409);\n  }\n  \n  // Query OCC API to get well details and coordinates\n  console.log(`Querying OCC for well API: ${cleanApi}`);\n  const wellDetails = await fetchWellDetailsFromOCC(cleanApi, env);\n  \n  let occMapLink = \"#\";\n  let suggestedWellName = body.wellName || \"\";\n  let operator = \"\";\n  let county = \"\";\n  let section = \"\";\n  let township = \"\";\n  let range = \"\";\n  let wellType = \"\";\n  let wellStatus = \"\";\n  \n  if (wellDetails) {\n    // Generate proper map link with coordinates\n    occMapLink = generateMapLink(wellDetails.lat, wellDetails.lon, wellDetails.wellName);\n    \n    // If user didn't provide a well name, use the one from OCC\n    if (!suggestedWellName && wellDetails.wellName) {\n      suggestedWellName = wellDetails.wellName;\n    }\n    \n    // Capture all OCC data\n    operator = wellDetails.operator || \"\";\n    county = wellDetails.county || \"\";\n    section = wellDetails.section ? String(wellDetails.section) : \"\";\n    township = wellDetails.township || \"\";\n    range = wellDetails.range || \"\";\n    wellType = wellDetails.wellType || \"\";\n    wellStatus = wellDetails.wellStatus || \"\";\n    \n    console.log(`OCC well found: ${wellDetails.wellName} - ${operator} - ${county} County`);\n  } else {\n    console.warn(`Well API ${cleanApi} not found in OCC database - may be pending or invalid`);\n    // Still allow adding, but with placeholder link and empty fields\n  }\n  \n  const createUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(WELLS_TABLE)}`;\n  const response = await fetch(createUrl, {\n    method: \"POST\",\n    headers: {\n      Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}`,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      fields: {\n        User: [user.id],\n        \"API Number\": cleanApi,\n        \"Well Name\": suggestedWellName,\n        Status: \"Active\",\n        \"OCC Map Link\": occMapLink,\n        Operator: operator,\n        County: county,\n        Section: section,\n        Township: township,\n        Range: range,\n        \"Well Type\": wellType,\n        \"Well Status\": wellStatus,\n        Notes: body.notes || \"\"\n      }\n    })\n  });\n  \n  if (!response.ok) {\n    const err = await response.text();\n    console.error(\"Airtable create well error:\", err);\n    throw new Error(\"Failed to create well\");\n  }\n  \n  const newRecord = await response.json();\n  console.log(`Well added: API ${cleanApi} for ${user.email}`);\n  return jsonResponse(newRecord, 201);\n}\n\n/**\n * Delete a well for the authenticated user\n * @param wellId The well ID to delete\n * @param request The incoming request\n * @param env Worker environment\n * @returns JSON response with success status\n */\nexport async function handleDeleteWell(wellId: string, request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  \n  const getUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(WELLS_TABLE)}/${wellId}`;\n  const getResponse = await fetch(getUrl, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  \n  if (!getResponse.ok) {\n    return jsonResponse({ error: \"Well not found\" }, 404);\n  }\n  \n  const well = await getResponse.json();\n  if (well.fields.User?.[0] !== user.id) {\n    return jsonResponse({ error: \"Not authorized\" }, 403);\n  }\n  \n  const deleteUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(WELLS_TABLE)}/${wellId}`;\n  await fetch(deleteUrl, {\n    method: \"DELETE\",\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  \n  console.log(`Well deleted: ${wellId} by ${user.email}`);\n  return jsonResponse({ success: true });\n}\n\n/**\n * Update well notes for the authenticated user\n * @param wellId The well ID to update\n * @param request The incoming request with notes data\n * @param env Worker environment\n * @returns JSON response with success status\n */\nexport async function handleUpdateWellNotes(wellId: string, request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  \n  const body = await request.json();\n  let notes = body.notes || \"\";\n  \n  // Limit notes length to prevent abuse\n  if (notes.length > 1000) {\n    notes = notes.substring(0, 1000);\n  }\n  \n  // Verify ownership\n  const getUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(WELLS_TABLE)}/${wellId}`;\n  const getResponse = await fetch(getUrl, {\n    headers: { Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}` }\n  });\n  \n  if (!getResponse.ok) {\n    return jsonResponse({ error: \"Well not found\" }, 404);\n  }\n  \n  const well = await getResponse.json();\n  if (well.fields.User?.[0] !== user.id) {\n    return jsonResponse({ error: \"Not authorized\" }, 403);\n  }\n  \n  // Update notes\n  const updateUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(WELLS_TABLE)}/${wellId}`;\n  const updateResponse = await fetch(updateUrl, {\n    method: \"PATCH\",\n    headers: {\n      Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}`,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({ fields: { Notes: notes } })\n  });\n  \n  if (!updateResponse.ok) {\n    return jsonResponse({ error: \"Failed to update notes\" }, 500);\n  }\n  \n  return jsonResponse({ success: true });\n}", "/**\n * Auth Handlers\n * \n * Handles authentication flow including magic links, registration, and user management\n */\n\nimport { \n  BASE_ID,\n  USERS_TABLE,\n  COOKIE_NAME,\n  TOKEN_EXPIRY,\n  SESSION_EXPIRY,\n  BASE_URL,\n  CORS_HEADERS\n} from '../constants.js';\n\nimport { \n  jsonResponse,\n  redirectWithError\n} from '../utils/responses.js';\n\nimport {\n  authenticateRequest,\n  generateToken,\n  verifyToken\n} from '../utils/auth.js';\n\nimport {\n  findUserByEmail\n} from '../services/airtable.js';\n\nimport {\n  sendMagicLinkEmail,\n  getFreeWelcomeEmailHtml,\n  getFreeWelcomeEmailText\n} from '../services/postmark.js';\n\nimport type { Env } from '../types/env.js';\n\n/**\n * Send a magic link email for user authentication\n * @param request The incoming request with email\n * @param env Worker environment\n * @returns JSON response confirming email sent\n */\nexport async function handleSendMagicLink(request: Request, env: Env) {\n  const { email } = await request.json();\n  if (!email || !email.includes(\"@\")) {\n    return jsonResponse({ error: \"Valid email required\" }, 400);\n  }\n  const normalizedEmail = email.toLowerCase().trim();\n  const user = await findUserByEmail(env, normalizedEmail);\n  if (!user || user.fields.Status !== \"Active\") {\n    console.log(`Login attempt for non-existent/inactive user: ${normalizedEmail}`);\n    return jsonResponse({ success: true });\n  }\n  const token = await generateToken(env, {\n    email: normalizedEmail,\n    id: user.id,\n    exp: Date.now() + TOKEN_EXPIRY\n  });\n  const magicLink = `${BASE_URL}/api/auth/verify?token=${token}`;\n  await sendMagicLinkEmail(env, normalizedEmail, user.fields.Name || \"there\", magicLink);\n  console.log(`Magic link sent to: ${normalizedEmail}`);\n  return jsonResponse({ success: true });\n}\n\n/**\n * Verify token and create user session\n * @param request The incoming request\n * @param env Worker environment\n * @param url URL object with token parameter\n * @returns Redirect to portal with session cookie\n */\nexport async function handleVerifyToken(request: Request, env: Env, url: URL) {\n  const token = url.searchParams.get(\"token\");\n  if (!token) {\n    return redirectWithError(\"Missing token\");\n  }\n  let payload;\n  try {\n    payload = await verifyToken(env, token);\n  } catch (err) {\n    console.error(\"Token verification failed:\", (err as Error).message);\n    return redirectWithError(\"Invalid or expired link. Please request a new one.\");\n  }\n  if (Date.now() > payload.exp) {\n    return redirectWithError(\"This link has expired. Please request a new one.\");\n  }\n  const sessionToken = await generateToken(env, {\n    email: payload.email,\n    id: payload.id,\n    exp: Date.now() + SESSION_EXPIRY\n  }, 30 * 24 * 60 * 60);\n  console.log(`User logged in: ${payload.email}`);\n  return new Response(null, {\n    status: 302,\n    headers: {\n      \"Location\": \"/portal\",\n      \"Set-Cookie\": `${COOKIE_NAME}=${sessionToken}; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=${30 * 24 * 60 * 60}`\n    }\n  });\n}\n\n/**\n * Handle user logout by clearing session cookie\n * @returns JSON response with success and cleared cookie\n */\nexport function handleLogout(): Response {\n  return new Response(JSON.stringify({ success: true }), {\n    status: 200,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Set-Cookie\": `${COOKIE_NAME}=; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=0`,\n      ...CORS_HEADERS\n    }\n  });\n}\n\n/**\n * Get current authenticated user information\n * @param request The incoming request\n * @param env Worker environment\n * @returns JSON response with user data\n */\nexport async function handleGetCurrentUser(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) {\n    return jsonResponse({ error: \"Not authenticated\" }, 401);\n  }\n  const userRecord = await findUserByEmail(env, user.email);\n  if (!userRecord) {\n    return jsonResponse({ error: \"User not found\" }, 401);\n  }\n  return jsonResponse({\n    id: userRecord.id,\n    email: userRecord.fields.Email,\n    name: userRecord.fields.Name,\n    plan: userRecord.fields.Plan || \"Free\",\n    status: userRecord.fields.Status,\n    stripeCustomerId: userRecord.fields[\"Stripe Customer ID\"]\n  });\n}\n\n/**\n * Register a new user account\n * @param request The incoming request with user data\n * @param env Worker environment\n * @returns JSON response confirming registration\n */\nexport async function handleRegister(request: Request, env: Env) {\n  try {\n    console.log(\"Starting user registration\");\n    \n    const body = await request.json();\n    console.log(\"Request body parsed successfully\");\n    \n    const { email, name } = body;\n    \n    // Validate email\n    if (!email || !email.includes('@')) {\n      console.log(\"Invalid email provided\");\n      return jsonResponse({ error: \"Valid email is required\" }, 400);\n    }\n    \n    // Normalize email\n    const normalizedEmail = email.toLowerCase().trim();\n    console.log(`Processing registration for: ${normalizedEmail}`);\n    \n    // Check if user already exists\n    console.log(\"Checking if user already exists\");\n    const existingUser = await findUserByEmail(env, normalizedEmail);\n    if (existingUser) {\n      console.log(\"User already exists\");\n      return jsonResponse({ error: \"An account with this email already exists\" }, 409);\n    }\n    console.log(\"User does not exist, proceeding with creation\");\n    \n    // Create new Free user\n    console.log(\"Creating user in Airtable\");\n    const createUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(USERS_TABLE)}`;\n    const response = await fetch(createUrl, {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}`,\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        fields: {\n          Email: normalizedEmail,\n          Name: name || normalizedEmail.split('@')[0],\n          Plan: \"Free\",\n          Status: \"Active\"\n        }\n      })\n    });\n    \n    if (!response.ok) {\n      const err = await response.text();\n      console.error(\"Airtable create user error:\", err);\n      return jsonResponse({ error: \"Failed to create account\" }, 500);\n    }\n    \n    console.log(\"User created successfully in Airtable\");\n    const newUser = await response.json();\n    console.log(`New Free user registered: ${normalizedEmail}`);\n    \n    // Generate magic link token and send login email\n    const token = crypto.randomUUID();\n    const expiresAt = Date.now() + (15 * 60 * 1000); // 15 min\n    \n    // Store token (using same logic as handleLogin)\n    await env.AUTH_TOKENS.put(token, JSON.stringify({\n      email: normalizedEmail,\n      expiresAt\n    }), { expirationTtl: 900 });\n    \n    // Send welcome/login email via Postmark\n    const magicLink = `${BASE_URL}/api/auth/verify?token=${token}`;\n    \n    console.log(`Sending welcome email to: ${normalizedEmail}`);\n    \n    let htmlBody, textBody;\n    try {\n      const userName = name || normalizedEmail.split(\"@\")[0];\n      console.log(`Generating email templates for user: ${userName}`);\n      htmlBody = getFreeWelcomeEmailHtml(userName, magicLink);\n      textBody = getFreeWelcomeEmailText(userName, magicLink);\n      console.log(\"Email templates generated successfully\");\n    } catch (templateError) {\n      console.error(\"Error generating email templates:\", templateError);\n      throw templateError;\n    }\n    \n    const emailResponse = await fetch(\"https://api.postmarkapp.com/email\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-Postmark-Server-Token\": env.POSTMARK_API_KEY\n      },\n      body: JSON.stringify({\n        From: \"support@mymineralwatch.com\",\n        To: normalizedEmail,\n        Subject: \"Welcome to Mineral Watch - Verify Your Account\",\n        HtmlBody: htmlBody,\n        TextBody: textBody\n      })\n    });\n    \n    if (!emailResponse.ok) {\n      const emailError = await emailResponse.text();\n      console.error(\"Postmark email error:\", emailError);\n      // Don't fail registration if email fails - just log the error\n    }\n    \n    return jsonResponse({ \n      success: true, \n      message: \"Account created! Check your email to verify and log in.\"\n    }, 201);\n    \n  } catch (err) {\n    console.error(\"Registration error:\", (err as Error).message);\n    console.error(\"Full error:\", (err as Error).stack || err);\n    return jsonResponse({ error: \"Registration failed\" }, 500);\n  }\n}", "/**\n * Billing Handlers\n * \n * Handles Stripe billing integration including upgrades, billing portal, and subscription management\n */\n\nimport { \n  BASE_ID,\n  USERS_TABLE,\n  BASE_URL,\n  PRICE_IDS,\n  PRICE_TO_PLAN\n} from '../constants.js';\n\nimport { \n  jsonResponse \n} from '../utils/responses.js';\n\nimport {\n  authenticateRequest\n} from '../utils/auth.js';\n\nimport {\n  findUserByEmail,\n  getUserById\n} from '../services/airtable.js';\n\nimport type { Env } from '../types/env.js';\n\n/**\n * Create a Stripe Checkout session for new subscriptions\n * @param env Worker environment\n * @param user User session payload\n * @param priceId Stripe price ID\n * @param existingCustomerId Optional existing Stripe customer ID\n * @returns JSON response with checkout URL\n */\nasync function createCheckoutSession(env: Env, user: any, priceId: string, existingCustomerId?: string) {\n  const params = new URLSearchParams();\n  params.append('mode', 'subscription');\n  params.append('success_url', `${BASE_URL}/api/upgrade/success?session_id={CHECKOUT_SESSION_ID}`);\n  params.append('cancel_url', `${BASE_URL}/portal/upgrade`);\n  params.append('line_items[0][price]', priceId);\n  params.append('line_items[0][quantity]', '1');\n  params.append('customer_email', user.email);\n  \n  // If they have a customer ID (e.g., cancelled before), use it\n  if (existingCustomerId) {\n    params.delete('customer_email');\n    params.append('customer', existingCustomerId);\n  }\n  \n  const response = await fetch('https://api.stripe.com/v1/checkout/sessions', {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${env.STRIPE_SECRET_KEY}`,\n      'Content-Type': 'application/x-www-form-urlencoded'\n    },\n    body: params.toString()\n  });\n  \n  if (!response.ok) {\n    const err = await response.text();\n    console.error('Checkout session error:', err);\n    return jsonResponse({ error: 'Failed to create checkout session' }, 500);\n  }\n  \n  const session = await response.json();\n  return jsonResponse({ url: session.url, type: 'checkout' });\n}\n\n/**\n * Update an existing Stripe subscription\n * @param env Worker environment\n * @param user User session payload\n * @param subscriptionId Stripe subscription ID\n * @param newPriceId New Stripe price ID\n * @param targetPlan Target plan name\n * @returns JSON response with update status\n */\nasync function updateSubscription(env: Env, user: any, subscriptionId: string, newPriceId: string, targetPlan: string) {\n  // First, get the current subscription to find the item ID\n  const getSubResponse = await fetch(`https://api.stripe.com/v1/subscriptions/${subscriptionId}`, {\n    headers: { 'Authorization': `Bearer ${env.STRIPE_SECRET_KEY}` }\n  });\n  \n  if (!getSubResponse.ok) {\n    return jsonResponse({ error: 'Could not find subscription' }, 404);\n  }\n  \n  const subscription = await getSubResponse.json();\n  const itemId = subscription.items?.data?.[0]?.id;\n  \n  if (!itemId) {\n    return jsonResponse({ error: 'Subscription has no items' }, 400);\n  }\n  \n  // Update the subscription with the new price\n  const params = new URLSearchParams();\n  params.append('items[0][id]', itemId);\n  params.append('items[0][price]', newPriceId);\n  params.append('proration_behavior', 'always_invoice'); // Charge/credit immediately\n  \n  const updateResponse = await fetch(`https://api.stripe.com/v1/subscriptions/${subscriptionId}`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${env.STRIPE_SECRET_KEY}`,\n      'Content-Type': 'application/x-www-form-urlencoded'\n    },\n    body: params.toString()\n  });\n  \n  if (!updateResponse.ok) {\n    const err = await updateResponse.text();\n    console.error('Subscription update error:', err);\n    return jsonResponse({ error: 'Failed to update subscription' }, 500);\n  }\n  \n  // Update Airtable immediately (webhook will also fire, but this is faster)\n  const userRecord = await findUserByEmail(env, user.email);\n  if (userRecord) {\n    await fetch(`https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(USERS_TABLE)}/${userRecord.id}`, {\n      method: 'PATCH',\n      headers: {\n        'Authorization': `Bearer ${env.MINERAL_AIRTABLE_API_KEY}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({ fields: { Plan: targetPlan } })\n    });\n  }\n  \n  console.log(`User ${user.email} upgraded to ${targetPlan}`);\n  \n  return jsonResponse({ \n    success: true, \n    type: 'updated',\n    message: `Successfully changed to ${targetPlan} plan!`\n  });\n}\n\n/**\n * Handle billing portal access for existing customers\n * @param request The incoming request\n * @param env Worker environment\n * @returns JSON response with billing portal URL\n */\nexport async function handleBillingPortal(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  const userRecord = await findUserByEmail(env, user.email);\n  const customerId = userRecord?.fields[\"Stripe Customer ID\"];\n  if (!customerId) {\n    return jsonResponse({ error: \"No billing account found\" }, 404);\n  }\n  const response = await fetch(\"https://api.stripe.com/v1/billing_portal/sessions\", {\n    method: \"POST\",\n    headers: {\n      \"Authorization\": `Bearer ${env.STRIPE_SECRET_KEY}`,\n      \"Content-Type\": \"application/x-www-form-urlencoded\"\n    },\n    body: `customer=${customerId}&return_url=${encodeURIComponent(BASE_URL + \"/portal/account\")}`\n  });\n  if (!response.ok) {\n    console.error(\"Stripe error:\", await response.text());\n    return jsonResponse({ error: \"Failed to create billing session\" }, 500);\n  }\n  const session = await response.json();\n  return jsonResponse({ url: session.url });\n}\n\n/**\n * Handle plan upgrades and subscription changes\n * @param request The incoming request with plan and interval\n * @param env Worker environment\n * @returns JSON response with upgrade URL or status\n */\nexport async function handleUpgrade(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  \n  const body = await request.json();\n  const { plan, interval } = body; // plan: 'starter'|'standard'|'professional', interval: 'monthly'|'annual'\n  \n  const priceKey = `${plan}_${interval}`;\n  const priceId = PRICE_IDS[priceKey as keyof typeof PRICE_IDS];\n  \n  if (!priceId) {\n    return jsonResponse({ error: \"Invalid plan or interval\" }, 400);\n  }\n  \n  const userRecord = await getUserById(env, user.id);\n  const currentPlan = userRecord?.fields.Plan || 'Free';\n  const stripeCustomerId = userRecord?.fields[\"Stripe Customer ID\"];\n  const subscriptionId = userRecord?.fields[\"Stripe Subscription ID\"];\n  \n  // Determine target plan name\n  const targetPlan = PRICE_TO_PLAN[priceId as keyof typeof PRICE_TO_PLAN];\n  \n  // Don't allow \"upgrading\" to same plan\n  if (currentPlan === targetPlan) {\n    return jsonResponse({ error: \"You're already on this plan\" }, 400);\n  }\n  \n  // CASE 1: Free user or no subscription - create Checkout session\n  if (currentPlan === 'Free' || !subscriptionId) {\n    return await createCheckoutSession(env, user, priceId, stripeCustomerId);\n  }\n  \n  // CASE 2: Existing subscriber - update subscription directly\n  return await updateSubscription(env, user, subscriptionId, priceId, targetPlan);\n}\n\n/**\n * Handle post-checkout success redirect\n * @param request The incoming request\n * @param env Worker environment\n * @param url URL object with session_id parameter\n * @returns Redirect response to portal\n */\nexport async function handleUpgradeSuccess(request: Request, env: Env, url: URL) {\n  const sessionId = url.searchParams.get('session_id');\n  \n  if (!sessionId) {\n    return Response.redirect(`${BASE_URL}/portal/upgrade?error=missing_session`, 302);\n  }\n  \n  // Webhook will handle the actual user creation/update\n  // Just redirect to dashboard with success message\n  return Response.redirect(`${BASE_URL}/portal?upgraded=true`, 302);\n}", "/**\n * Bulk Upload Handlers\n * \n * Handles bulk validation and upload of properties and wells with normalization\n */\n\nimport { \n  BASE_ID,\n  PROPERTIES_TABLE,\n  WELLS_TABLE,\n  PLAN_LIMITS,\n  MAX_NOTES_LENGTH\n} from '../constants.js';\n\nimport { \n  jsonResponse \n} from '../utils/responses.js';\n\nimport {\n  authenticateRequest\n} from '../utils/auth.js';\n\nimport {\n  getUserById,\n  countUserProperties,\n  countUserWells,\n  fetchUserProperties,\n  fetchUserWells\n} from '../services/airtable.js';\n\nimport {\n  fetchWellDetailsFromOCC\n} from './wells.js';\n\nimport type { Env } from '../types/env.js';\n\n// Normalization Helper Functions\n\nfunction normalizeSectionNumber(value: any): number | null {\n  if (!value) return null;\n  \n  // Convert to string and clean\n  let str = String(value).trim().toUpperCase();\n  \n  // Remove common prefixes\n  str = str.replace(/^(S|SEC|SECTION)\\s*/i, '');\n  \n  // Extract just the number\n  const match = str.match(/(\\d+)/);\n  if (!match) return null;\n  \n  const num = parseInt(match[1], 10);\n  \n  // Validate range (1-36 for sections)\n  if (num >= 1 && num <= 36) {\n    return num;\n  }\n  \n  return null;\n}\n\nfunction normalizeTownship(value: any): string | null {\n  if (!value) return null;\n  \n  let str = String(value).trim().toUpperCase();\n  \n  // Remove prefixes\n  str = str.replace(/^(T|TOWN|TOWNSHIP)\\s*/i, '');\n  \n  // Remove spaces\n  str = str.replace(/\\s+/g, '');\n  \n  // Must be digits followed by N or S\n  if (!/^\\d+[NS]$/i.test(str)) {\n    return null;\n  }\n  \n  // Normalize to uppercase\n  return str.toUpperCase();\n}\n\nfunction normalizeRange(value: any): string | null {\n  if (!value) return null;\n  \n  let str = String(value).trim().toUpperCase();\n  \n  // Remove prefixes\n  str = str.replace(/^(R|RANGE)\\s*/i, '');\n  \n  // Remove spaces\n  str = str.replace(/\\s+/g, '');\n  \n  // Must be digits followed by E or W\n  if (!/^\\d+[EW]$/i.test(str)) {\n    return null;\n  }\n  \n  // Normalize to uppercase\n  return str.toUpperCase();\n}\n\nfunction normalizeMeridian(value: any): string {\n  if (!value) return \"IM\"; // Default to Indian Meridian\n  \n  const str = String(value).trim().toUpperCase();\n  \n  // Indian Meridian\n  if (str.match(/^(IM|I|INDIAN)/i)) {\n    return \"IM\";\n  }\n  \n  // Cimarron Meridian\n  if (str.match(/^(CM|C|CIMARRON)/i)) {\n    return \"CM\";\n  }\n  \n  // Default to Indian Meridian\n  return \"IM\";\n}\n\nfunction normalizeCounty(value: any): string {\n  if (!value) return \"\";\n  \n  const str = String(value).trim();\n  \n  // Capitalize first letter of each word\n  return str\n    .split(' ')\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n    .join(' ');\n}\n\nfunction normalizePropertyData(prop: any) {\n  let notes = prop.NOTES || prop.Notes || prop.Note || prop.Comments || \"\";\n  // Truncate notes to prevent abuse\n  if (notes.length > MAX_NOTES_LENGTH) {\n    notes = notes.substring(0, MAX_NOTES_LENGTH);\n  }\n  \n  return {\n    SEC: normalizeSectionNumber(prop.SEC || prop.Section || prop.Sec || prop.S),\n    TWN: normalizeTownship(prop.TWN || prop.Township || prop.Town || prop.T),\n    RNG: normalizeRange(prop.RNG || prop.Range || prop.R),\n    MERIDIAN: normalizeMeridian(prop.MERIDIAN || prop.Meridian || prop.MER || prop.Mer || prop.M),\n    COUNTY: normalizeCounty(prop.COUNTY || prop.County || prop.Co || prop.C),\n    NOTES: notes\n  };\n}\n\n// Validation Helper Functions\n\nfunction validateTownship(value: string): boolean {\n  if (!value) return false;\n  return /^\\d+[NS]$/i.test(value);\n}\n\nfunction validateRange(value: string): boolean {\n  if (!value) return false;\n  return /^\\d+[EW]$/i.test(value);\n}\n\n/**\n * Validate properties from bulk upload\n * @param request The incoming request with properties array\n * @param env Worker environment\n * @returns JSON response with validation results\n */\nexport async function handleBulkValidateProperties(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  \n  const body = await request.json();\n  const { properties } = body; // Array of parsed property objects\n  \n  if (!properties || !Array.isArray(properties)) {\n    return jsonResponse({ error: \"Invalid data format\" }, 400);\n  }\n  \n  // Get user's current properties for duplicate checking\n  const existingProperties = await fetchUserProperties(env, user.email);\n  const existingSet = new Set(\n    existingProperties.map(p => \n      `${p.SEC}-${p.TWN}-${p.RNG}-${p.MERIDIAN || 'IM'}`\n    )\n  );\n  \n  // Get user's plan limits\n  const userRecord = await getUserById(env, user.id);\n  const plan = userRecord?.fields.Plan || \"Free\";\n  const planLimits = PLAN_LIMITS[plan] || { properties: 1, wells: 0 };\n  \n  const propertiesCount = await countUserProperties(env, user.email);\n  const currentPropertyCount = propertiesCount;\n  \n  // Validate each property\n  const results = properties.map((prop: any, index: number) => {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n    \n    // Normalize data\n    const normalized = normalizePropertyData(prop);\n    \n    // Validate required fields\n    if (!normalized.SEC) {\n      errors.push(\"Missing section number\");\n    } else if (normalized.SEC < 1 || normalized.SEC > 36) {\n      errors.push(\"Section must be 1-36\");\n    }\n    \n    if (!normalized.TWN) {\n      errors.push(\"Missing township\");\n    } else if (!validateTownship(normalized.TWN)) {\n      errors.push(\"Invalid township format (e.g. 12N)\");\n    }\n    \n    if (!normalized.RNG) {\n      errors.push(\"Missing range\");\n    } else if (!validateRange(normalized.RNG)) {\n      errors.push(\"Invalid range format (e.g. 4W)\");\n    }\n    \n    // Check for duplicates\n    const key = `${normalized.SEC}-${normalized.TWN}-${normalized.RNG}-${normalized.MERIDIAN}`;\n    const isDuplicate = existingSet.has(key);\n    if (isDuplicate) {\n      warnings.push(\"Already monitoring this property\");\n    }\n    \n    // Default meridian warning\n    if (!prop.MERIDIAN && !prop.MER && !prop.Meridian && !prop.M) {\n      warnings.push(\"Meridian defaulted to IM (Indian Meridian)\");\n    }\n    \n    return {\n      index,\n      original: prop,\n      normalized,\n      errors,\n      warnings,\n      isDuplicate,\n      isValid: errors.length === 0\n    };\n  });\n  \n  // Count valid non-duplicates\n  const validCount = results.filter(r => r.isValid && !r.isDuplicate).length;\n  const newPropertyCount = currentPropertyCount + validCount;\n  const wouldExceedLimit = newPropertyCount > planLimits.properties;\n  \n  return jsonResponse({\n    results,\n    summary: {\n      total: properties.length,\n      valid: results.filter(r => r.isValid).length,\n      invalid: results.filter(r => !r.isValid).length,\n      duplicates: results.filter(r => r.isDuplicate).length,\n      warnings: results.filter(r => r.warnings.length > 0).length,\n      willImport: validCount\n    },\n    planCheck: {\n      current: currentPropertyCount,\n      limit: planLimits.properties,\n      plan,\n      afterUpload: newPropertyCount,\n      wouldExceedLimit\n    }\n  });\n}\n\n/**\n * Upload validated properties in bulk\n * @param request The incoming request with validated properties\n * @param env Worker environment\n * @returns JSON response with upload results\n */\nexport async function handleBulkUploadProperties(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  \n  const body = await request.json();\n  const { properties } = body; // Array of validated, normalized property objects\n  \n  if (!properties || !Array.isArray(properties)) {\n    return jsonResponse({ error: \"Invalid data format\" }, 400);\n  }\n  \n  // Final validation check (security - never trust client)\n  const userRecord = await getUserById(env, user.id);\n  const plan = userRecord?.fields.Plan || \"Free\";\n  const planLimits = PLAN_LIMITS[plan] || { properties: 1, wells: 0 };\n  \n  const propertiesCount = await countUserProperties(env, user.email);\n  \n  if (propertiesCount + properties.length > planLimits.properties) {\n    return jsonResponse({ \n      error: `Would exceed property limit (${planLimits.properties} properties on ${plan} plan)` \n    }, 403);\n  }\n  \n  // Get existing properties for duplicate check\n  const existingProperties = await fetchUserProperties(env, user.email);\n  const existingSet = new Set(\n    existingProperties.map(p => \n      `${p.SEC}-${p.TWN}-${p.RNG}-${p.MERIDIAN || 'IM'}`\n    )\n  );\n  \n  // Filter out duplicates and invalid\n  const toCreate = properties.filter((prop: any) => {\n    const key = `${prop.SEC}-${prop.TWN}-${prop.RNG}-${prop.MERIDIAN}`;\n    return !existingSet.has(key) && \n           prop.SEC >= 1 && prop.SEC <= 36 &&\n           validateTownship(prop.TWN) &&\n           validateRange(prop.RNG);\n  });\n  \n  console.log(`Bulk upload: Creating ${toCreate.length} properties for ${user.email}`);\n  \n  // Create in batches of 10 (Airtable limit)\n  const batchSize = 10;\n  const results = {\n    successful: 0,\n    failed: 0,\n    skipped: properties.length - toCreate.length,\n    errors: []\n  };\n  \n  for (let i = 0; i < toCreate.length; i += batchSize) {\n    const batch = toCreate.slice(i, i + batchSize);\n    \n    const createUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(PROPERTIES_TABLE)}`;\n    const response = await fetch(createUrl, {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}`,\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        records: batch.map((prop: any) => ({\n          fields: {\n            User: [user.id],\n            SEC: String(prop.SEC).padStart(2, '0'),\n            TWN: prop.TWN,\n            RNG: prop.RNG,\n            MERIDIAN: prop.MERIDIAN,\n            COUNTY: prop.COUNTY || \"\",\n            \"Monitor Adjacent\": true,\n            Status: \"Active\",\n            Notes: prop.NOTES || \"\"\n          }\n        }))\n      })\n    });\n    \n    if (response.ok) {\n      const data = await response.json();\n      results.successful += data.records.length;\n    } else {\n      const err = await response.text();\n      console.error(`Batch create failed:`, err);\n      results.failed += batch.length;\n      results.errors.push(`Batch ${Math.floor(i/batchSize) + 1} failed: ${err}`);\n    }\n    \n    // Small delay between batches to be nice to Airtable\n    if (i + batchSize < toCreate.length) {\n      await new Promise(resolve => setTimeout(resolve, 200));\n    }\n  }\n  \n  console.log(`Bulk upload complete: ${results.successful} created, ${results.failed} failed, ${results.skipped} skipped`);\n  \n  return jsonResponse({\n    success: true,\n    results\n  });\n}\n\n/**\n * Validate wells from bulk upload\n * @param request The incoming request with wells array\n * @param env Worker environment\n * @returns JSON response with validation results\n */\nexport async function handleBulkValidateWells(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  \n  const body = await request.json();\n  const { wells } = body; // Array of { apiNumber, wellName? }\n  \n  if (!wells || !Array.isArray(wells) || wells.length === 0) {\n    return jsonResponse({ error: \"No wells data provided\" }, 400);\n  }\n  \n  // Check plan allows wells\n  const userRecord = await getUserById(env, user.id);\n  const plan = userRecord?.fields.Plan || \"Free\";\n  const planLimits = PLAN_LIMITS[plan] || { properties: 1, wells: 0 };\n  \n  if (planLimits.wells === 0) {\n    return jsonResponse({ \n      error: `Your ${plan} plan does not include well monitoring. Please upgrade to add wells.` \n    }, 403);\n  }\n  \n  // Get user's existing wells for duplicate checking\n  const existingWells = await fetchUserWells(env, user.email);\n  const existingSet = new Set(existingWells.map(w => w.apiNumber));\n  \n  const wellsCount = existingWells.length;\n  \n  // Validate each well\n  const results = wells.map((well: any, index: number) => {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n    \n    // Clean API number\n    const rawApi = well.apiNumber || well.API || well.api || '';\n    const cleanApi = String(rawApi).replace(/\\D/g, '');\n    \n    // Validate API format\n    if (!cleanApi) {\n      errors.push(\"Missing API number\");\n    } else if (cleanApi.length !== 10) {\n      errors.push(\"API must be 10 digits\");\n    } else if (!cleanApi.startsWith('35')) {\n      errors.push(\"Oklahoma APIs start with 35\");\n    }\n    \n    // Check for duplicate in existing wells\n    const isDuplicate = existingSet.has(cleanApi);\n    if (isDuplicate) {\n      // Not an error, just flagged\n    }\n    \n    // Check for duplicate in this batch\n    const batchDuplicates = wells.slice(0, index).filter((w: any) => {\n      const api = String(w.apiNumber || w.API || w.api || '').replace(/\\D/g, '');\n      return api === cleanApi;\n    });\n    if (batchDuplicates.length > 0) {\n      warnings.push(\"Duplicate in this file\");\n    }\n    \n    // Truncate notes to prevent abuse\n    let notes = well.notes || well.Notes || well.NOTE || well.Note || well.Comments || well.comments || '';\n    if (notes.length > 1000) {\n      notes = notes.substring(0, 1000);\n    }\n    \n    return {\n      row: index + 1,\n      original: well,\n      normalized: {\n        apiNumber: cleanApi,\n        wellName: well.wellName || well.WELL_NAME || well.Well_Name || well.name || '',\n        notes: notes\n      },\n      errors,\n      warnings,\n      isDuplicate,\n      isValid: errors.length === 0\n    };\n  });\n  \n  // Count valid non-duplicates\n  const validCount = results.filter(r => r.isValid && !r.isDuplicate).length;\n  const newWellCount = wellsCount + validCount;\n  const wouldExceedLimit = newWellCount > planLimits.wells;\n  \n  return jsonResponse({\n    results,\n    summary: {\n      total: wells.length,\n      valid: results.filter(r => r.isValid).length,\n      invalid: results.filter(r => !r.isValid).length,\n      duplicates: results.filter(r => r.isDuplicate).length,\n      warnings: results.filter(r => r.warnings.length > 0).length,\n      willImport: validCount\n    },\n    planCheck: {\n      current: wellsCount,\n      limit: planLimits.wells,\n      plan,\n      afterUpload: newWellCount,\n      wouldExceedLimit\n    }\n  });\n}\n\n/**\n * Upload validated wells in bulk with OCC data enrichment\n * @param request The incoming request with validated wells\n * @param env Worker environment\n * @returns JSON response with upload results\n */\nexport async function handleBulkUploadWells(request: Request, env: Env) {\n  const user = await authenticateRequest(request, env);\n  if (!user) return jsonResponse({ error: \"Unauthorized\" }, 401);\n  \n  const body = await request.json();\n  const { wells } = body; // Array of validated, normalized well objects\n  \n  if (!wells || !Array.isArray(wells)) {\n    return jsonResponse({ error: \"Invalid data format\" }, 400);\n  }\n  \n  // Final validation check\n  const userRecord = await getUserById(env, user.id);\n  const plan = userRecord?.fields.Plan || \"Free\";\n  const planLimits = PLAN_LIMITS[plan] || { properties: 1, wells: 0 };\n  \n  if (planLimits.wells === 0) {\n    return jsonResponse({ \n      error: `Your ${plan} plan does not include well monitoring.` \n    }, 403);\n  }\n  \n  const wellsCount = await countUserWells(env, user.email);\n  \n  if (wellsCount + wells.length > planLimits.wells) {\n    return jsonResponse({ \n      error: `Would exceed well limit (${planLimits.wells} wells on ${plan} plan)` \n    }, 403);\n  }\n  \n  // Get existing wells for duplicate check\n  const existingWells = await fetchUserWells(env, user.email);\n  const existingSet = new Set(existingWells.map(w => w.apiNumber));\n  \n  // Filter out duplicates and invalid\n  const toCreate = wells.filter((well: any) => {\n    return !existingSet.has(well.apiNumber) && \n           well.apiNumber.length === 10 &&\n           well.apiNumber.startsWith('35');\n  });\n  \n  const results = {\n    successful: 0,\n    failed: 0,\n    skipped: wells.length - toCreate.length,\n    errors: []\n  };\n  \n  // Fetch OCC data for each well (in parallel batches to speed up)\n  const wellsWithData: any[] = [];\n  const occBatchSize = 5; // Fetch 5 at a time from OCC\n  \n  for (let i = 0; i < toCreate.length; i += occBatchSize) {\n    const occBatch = toCreate.slice(i, i + occBatchSize);\n    const occPromises = occBatch.map(async (well: any) => {\n      const occData = await fetchWellDetailsFromOCC(well.apiNumber, env);\n      return { ...well, occData };\n    });\n    const batchResults = await Promise.all(occPromises);\n    wellsWithData.push(...batchResults);\n    \n    // Small delay between OCC batches\n    if (i + occBatchSize < toCreate.length) {\n      await new Promise(resolve => setTimeout(resolve, 100));\n    }\n  }\n  \n  // Helper function to generate map link - simplified version from wells.ts\n  function generateMapLink(lat: number, lon: number, title: string): string {\n    if (!lat || !lon) return \"#\"; \n    const appId = \"ba9b8612132f4106be6e3553dc0b827b\";\n    const markerTemplate = JSON.stringify({\n      title: title || \"Well Location\",\n      longitude: lon,\n      latitude: lat,\n      isIncludeShareUrl: true\n    });\n    return `https://gis.occ.ok.gov/portal/apps/webappviewer/index.html?id=${appId}&marker=${lon},${lat},,,,&markertemplate=${encodeURIComponent(markerTemplate)}&level=19`;\n  }\n  \n  // Create in Airtable batches of 10\n  const batchSize = 10;\n  for (let i = 0; i < wellsWithData.length; i += batchSize) {\n    const batch = wellsWithData.slice(i, i + batchSize);\n    \n    const response = await fetch(`https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(WELLS_TABLE)}`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${env.MINERAL_AIRTABLE_API_KEY}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        records: batch.map((well: any) => {\n          const occ = well.occData || {};\n          const mapLink = occ.lat && occ.lon ? generateMapLink(occ.lat, occ.lon, occ.wellName) : '#';\n          \n          return {\n            fields: {\n              User: [user.id],\n              \"API Number\": well.apiNumber,\n              \"Well Name\": occ.wellName || well.wellName || \"\",\n              Status: \"Active\",\n              \"OCC Map Link\": mapLink,\n              Operator: occ.operator || \"\",\n              County: occ.county || \"\",\n              Section: occ.section ? String(occ.section) : \"\",\n              Township: occ.township || \"\",\n              Range: occ.range || \"\",\n              \"Well Type\": occ.wellType || \"\",\n              \"Well Status\": occ.wellStatus || \"\",\n              Notes: well.notes || \"\"\n            }\n          };\n        })\n      })\n    });\n    \n    if (response.ok) {\n      const data = await response.json();\n      results.successful += data.records.length;\n    } else {\n      const err = await response.text();\n      console.error(`Batch create wells failed:`, err);\n      results.failed += batch.length;\n      results.errors.push(`Batch ${Math.floor(i/batchSize) + 1} failed: ${err}`);\n    }\n    \n    // Small delay between batches\n    if (i + batchSize < toCreate.length) {\n      await new Promise(resolve => setTimeout(resolve, 200));\n    }\n  }\n  \n  console.log(`Bulk wells upload complete: ${results.successful} created, ${results.failed} failed, ${results.skipped} skipped`);\n  \n  return jsonResponse({\n    success: true,\n    results\n  });\n}", "/**\n * Track Well Handlers\n * \n * Handles signed token-based well tracking from email alerts\n */\n\nimport { \n  BASE_ID,\n  WELLS_TABLE,\n  BASE_URL,\n  PLAN_LIMITS\n} from '../constants.js';\n\nimport {\n  authenticateRequest\n} from '../utils/auth.js';\n\nimport {\n  getUserById,\n  countUserWells,\n  checkDuplicateWell\n} from '../services/airtable.js';\n\nimport {\n  fetchWellDetailsFromOCC\n} from './wells.js';\n\nimport type { Env } from '../types/env.js';\n\n/**\n * Generate OCC map link with coordinates and title\n * @param lat Latitude\n * @param lon Longitude  \n * @param title Map marker title\n * @returns OCC map URL with marker\n */\nfunction generateMapLink(lat: number, lon: number, title: string): string {\n  if (!lat || !lon) return \"#\"; \n  const appId = \"ba9b8612132f4106be6e3553dc0b827b\";\n  const markerTemplate = JSON.stringify({\n    title: title || \"Well Location\",\n    longitude: lon,\n    latitude: lat,\n    isIncludeShareUrl: true\n  });\n  return `https://gis.occ.ok.gov/portal/apps/webappviewer/index.html?id=${appId}&marker=${lon},${lat},,,,&markertemplate=${encodeURIComponent(markerTemplate)}&level=19`;\n}\n\n/**\n * Validate a signed tracking token\n * @param userId User ID for tracking\n * @param apiNumber Well API number\n * @param expiration Token expiration timestamp\n * @param token Signed token to validate\n * @param secret Secret key for validation\n * @returns Validation result object\n */\nexport async function validateTrackToken(\n  userId: string, \n  apiNumber: string, \n  expiration: number, \n  token: string, \n  secret: string\n): Promise<{ valid: boolean; error?: string }> {\n  // Check expiration\n  const now = Math.floor(Date.now() / 1000);\n  if (now > expiration) {\n    return { valid: false, error: 'Link has expired' };\n  }\n  \n  // Generate expected token\n  const payload = `${userId}:${apiNumber}:${expiration}:${secret}`;\n  const encoder = new TextEncoder();\n  const data = encoder.encode(payload);\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n  const hashArray = new Uint8Array(hashBuffer);\n  const expectedToken = Array.from(hashArray).map(b => b.toString(16).padStart(2, '0')).join('');\n  \n  // Compare tokens\n  if (token !== expectedToken) {\n    return { valid: false, error: 'Invalid token' };\n  }\n  \n  return { valid: true };\n}\n\n/**\n * Generate success page for successful well tracking\n * @param apiNumber Well API number\n * @param alreadyTracking Whether user was already tracking this well\n * @param wellName Optional well name\n * @returns HTML success page\n */\nexport function generateTrackWellSuccessPage(apiNumber: string, alreadyTracking: boolean, wellName?: string): string {\n  return `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Well Tracked - Mineral Watch</title>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:wght@400;700;900&display=swap\" rel=\"stylesheet\">\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        body { font-family: Inter, sans-serif; background: #F3F4F6; }\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 40px; text-align: center; }\n        .success-icon { width: 80px; height: 80px; border-radius: 50%; background: #D1FAE5; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; font-size: 40px; }\n        h1 { font-family: Merriweather, serif; font-size: 28px; color: #047857; margin-bottom: 16px; }\n        .subtitle { font-size: 18px; color: #6B7280; margin-bottom: 32px; }\n        .well-info { background: #F9FAFB; border-radius: 8px; padding: 20px; margin-bottom: 32px; text-align: left; }\n        .well-info h3 { color: #374151; margin-bottom: 12px; }\n        .well-detail { display: flex; justify-content: space-between; margin-bottom: 8px; }\n        .well-detail:last-child { margin-bottom: 0; }\n        .label { color: #6B7280; }\n        .value { color: #111827; font-weight: 500; }\n        .buttons { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; }\n        .btn { padding: 12px 24px; border-radius: 8px; font-weight: 600; text-decoration: none; display: inline-block; }\n        .btn-primary { background: #047857; color: white; }\n        .btn-secondary { background: #E5E7EB; color: #374151; }\n        .btn:hover { opacity: 0.9; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"card\">\n            <div class=\"success-icon\">${alreadyTracking ? '\u2713' : '\uD83C\uDF89'}</div>\n            <h1>${alreadyTracking ? 'Already Tracking' : 'Successfully Added!'}</h1>\n            <p class=\"subtitle\">\n                ${alreadyTracking \n                  ? 'You\\'re already tracking this well.' \n                  : 'This well has been added to your tracking list.'}\n            </p>\n            \n            <div class=\"well-info\">\n                <h3>Well Information</h3>\n                <div class=\"well-detail\">\n                    <span class=\"label\">API Number:</span>\n                    <span class=\"value\">${apiNumber}</span>\n                </div>\n                ${wellName ? `\n                <div class=\"well-detail\">\n                    <span class=\"label\">Well Name:</span>\n                    <span class=\"value\">${wellName}</span>\n                </div>\n                ` : ''}\n                <div class=\"well-detail\">\n                    <span class=\"label\">Status:</span>\n                    <span class=\"value\">Active Monitoring</span>\n                </div>\n            </div>\n            \n            <div class=\"buttons\">\n                <a href=\"${BASE_URL}/portal\" class=\"btn btn-primary\">View Dashboard</a>\n                <a href=\"${BASE_URL}/portal\" class=\"btn btn-secondary\">Manage Wells</a>\n            </div>\n        </div>\n    </div>\n</body>\n</html>`;\n}\n\n/**\n * Generate error page for failed well tracking\n * @param message Error message to display\n * @param showUpgrade Whether to show upgrade button\n * @returns HTML error page\n */\nexport function generateTrackWellErrorPage(message: string, showUpgrade: boolean = false): string {\n  return `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Error - Mineral Watch</title>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:wght@400;700;900&display=swap\" rel=\"stylesheet\">\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        body { font-family: Inter, sans-serif; background: #F3F4F6; }\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 40px; text-align: center; }\n        .error-icon { width: 80px; height: 80px; border-radius: 50%; background: #FEF2F2; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; font-size: 40px; color: #DC2626; }\n        h1 { font-family: Merriweather, serif; font-size: 28px; color: #DC2626; margin-bottom: 16px; }\n        .message { font-size: 16px; color: #6B7280; margin-bottom: 32px; line-height: 1.5; }\n        .buttons { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; }\n        .btn { padding: 12px 24px; border-radius: 8px; font-weight: 600; text-decoration: none; display: inline-block; }\n        .btn-primary { background: #047857; color: white; }\n        .btn-secondary { background: #E5E7EB; color: #374151; }\n        .btn-warning { background: #F59E0B; color: white; }\n        .btn:hover { opacity: 0.9; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"card\">\n            <div class=\"error-icon\">\u26A0\uFE0F</div>\n            <h1>Unable to Track Well</h1>\n            <p class=\"message\">${message}</p>\n            \n            <div class=\"buttons\">\n                ${showUpgrade \n                  ? '<a href=\"' + BASE_URL + '/portal/upgrade\" class=\"btn btn-warning\">Upgrade Plan</a>'\n                  : ''\n                }\n                <a href=\"${BASE_URL}/portal\" class=\"btn btn-primary\">Go to Dashboard</a>\n                <a href=\"${BASE_URL}/portal/login\" class=\"btn btn-secondary\">Login</a>\n            </div>\n        </div>\n    </div>\n</body>\n</html>`;\n}\n\n/**\n * Handle track-this-well requests with signed token authentication\n * @param request The incoming request\n * @param env Worker environment\n * @param url URL object with tracking parameters\n * @returns HTML response with tracking result\n */\nexport async function handleTrackThisWell(request: Request, env: Env, url: URL): Promise<Response> {\n  const apiNumber = url.searchParams.get('api');\n  const userId = url.searchParams.get('user');\n  const token = url.searchParams.get('token');\n  const exp = url.searchParams.get('exp');\n  \n  // Check if we have signed token parameters\n  if (userId && token && exp && env.TRACK_WELL_SECRET) {\n    // Token-based flow (no auth required)\n    \n    // Validate API parameter\n    if (!apiNumber) {\n      return new Response(generateTrackWellErrorPage('Missing API number in tracking link.'), {\n        headers: { 'Content-Type': 'text/html' },\n        status: 400\n      });\n    }\n    \n    // Clean and validate API format\n    const cleanApi = apiNumber.replace(/\\D/g, '');\n    if (cleanApi.length !== 10 || !cleanApi.startsWith('35')) {\n      return new Response(generateTrackWellErrorPage('Invalid API format in tracking link.'), {\n        headers: { 'Content-Type': 'text/html' },\n        status: 400\n      });\n    }\n    \n    // Validate token\n    const expiration = parseInt(exp);\n    const tokenValidation = await validateTrackToken(userId, cleanApi, expiration, token, env.TRACK_WELL_SECRET);\n    \n    if (!tokenValidation.valid) {\n      return new Response(generateTrackWellErrorPage(`Tracking link is ${tokenValidation.error}. Please request a new alert email.`), {\n        headers: { 'Content-Type': 'text/html' },\n        status: 400\n      });\n    }\n    \n    try {\n      // Get user record\n      const userRecord = await getUserById(env, userId);\n      if (!userRecord) {\n        return new Response(generateTrackWellErrorPage('User not found. Please contact support.'), {\n          headers: { 'Content-Type': 'text/html' },\n          status: 404\n        });\n      }\n      \n      const userEmail = userRecord.fields.Email;\n      \n      // Check for duplicate well API for this user\n      const isDuplicate = await checkDuplicateWell(env, userEmail, cleanApi);\n      if (isDuplicate) {\n        return new Response(generateTrackWellSuccessPage(cleanApi, true), {\n          headers: { 'Content-Type': 'text/html' }\n        });\n      }\n      \n      // Check plan limits\n      const plan = userRecord?.fields.Plan || \"Free\";\n      const planLimits = PLAN_LIMITS[plan] || { properties: 1, wells: 0 };\n      \n      if (planLimits.wells === 0) {\n        return new Response(generateTrackWellErrorPage(`Your ${plan} plan does not include well monitoring. Please upgrade to add wells.`, true), {\n          headers: { 'Content-Type': 'text/html' },\n          status: 403\n        });\n      }\n      \n      const wellsCount = await countUserWells(env, userEmail);\n      if (wellsCount >= planLimits.wells) {\n        return new Response(generateTrackWellErrorPage(`Well limit reached (${planLimits.wells} wells on ${plan} plan). You have ${wellsCount} wells.`, true), {\n          headers: { 'Content-Type': 'text/html' },\n          status: 403\n        });\n      }\n      \n      // Query OCC API to get well details\n      const wellDetails = await fetchWellDetailsFromOCC(cleanApi, env);\n      \n      let occMapLink = \"#\";\n      let wellName = \"\";\n      let operator = \"\";\n      let county = \"\";\n      let section = \"\";\n      let township = \"\";\n      let range = \"\";\n      let wellType = \"\";\n      let wellStatus = \"\";\n      \n      if (wellDetails) {\n        occMapLink = generateMapLink(wellDetails.lat, wellDetails.lon, wellDetails.wellName);\n        wellName = wellDetails.wellName || \"\";\n        operator = wellDetails.operator || \"\";\n        county = wellDetails.county || \"\";\n        section = wellDetails.section ? String(wellDetails.section) : \"\";\n        township = wellDetails.township || \"\";\n        range = wellDetails.range || \"\";\n        wellType = wellDetails.wellType || \"\";\n        wellStatus = wellDetails.wellStatus || \"\";\n      }\n      \n      // Add the well to Airtable\n      const createUrl = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(WELLS_TABLE)}`;\n      const response = await fetch(createUrl, {\n        method: \"POST\",\n        headers: {\n          Authorization: `Bearer ${env.MINERAL_AIRTABLE_API_KEY}`,\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          fields: {\n            User: [userId],\n            \"API Number\": cleanApi,\n            \"Well Name\": wellName,\n            Status: \"Active\",\n            \"OCC Map Link\": occMapLink,\n            Operator: operator,\n            County: county,\n            Section: section,\n            Township: township,\n            Range: range,\n            \"Well Type\": wellType,\n            \"Well Status\": wellStatus,\n            Notes: \"Added via signed email tracking link\"\n          }\n        })\n      });\n      \n      if (!response.ok) {\n        const err = await response.text();\n        console.error(\"Airtable create well error:\", err);\n        return new Response(generateTrackWellErrorPage('Failed to add well. Please try again later.'), {\n          headers: { 'Content-Type': 'text/html' },\n          status: 500\n        });\n      }\n      \n      console.log(`Well added via signed email link: API ${cleanApi} for ${userEmail}`);\n      return new Response(generateTrackWellSuccessPage(cleanApi, false, wellName), {\n        headers: { 'Content-Type': 'text/html' }\n      });\n      \n    } catch (error) {\n      console.error(\"Track well error:\", error);\n      return new Response(generateTrackWellErrorPage('An error occurred. Please try again later.'), {\n        headers: { 'Content-Type': 'text/html' },\n        status: 500\n      });\n    }\n    \n  } else {\n    // Fallback to old auth-required flow\n    \n    // Validate API parameter\n    if (!apiNumber) {\n      return new Response(generateTrackWellErrorPage('Missing API number. Please use a valid tracking link.'), {\n        headers: { 'Content-Type': 'text/html' },\n        status: 400\n      });\n    }\n    \n    // Clean and validate API format\n    const cleanApi = apiNumber.replace(/\\D/g, '');\n    if (cleanApi.length !== 10 || !cleanApi.startsWith('35')) {\n      return new Response(generateTrackWellErrorPage('Invalid API format. Must be 10 digits starting with 35.'), {\n        headers: { 'Content-Type': 'text/html' },\n        status: 400\n      });\n    }\n    \n    // Check authentication\n    const user = await authenticateRequest(request, env);\n    if (!user) {\n      // Redirect to login with return URL\n      const returnUrl = encodeURIComponent(`/add-well?api=${cleanApi}`);\n      return Response.redirect(`${BASE_URL}/portal/login?return=${returnUrl}`, 302);\n    }\n    \n    return new Response(generateTrackWellErrorPage('This tracking link requires authentication. Please log in and try again.'), {\n      headers: { 'Content-Type': 'text/html' },\n      status: 400\n    });\n  }\n}", "// UPDATED MINERAL WATCH PORTAL WORKER - WITH WELLS SUPPORT\n// Deploy with: wrangler deploy\n\n// Import constants and utilities from modular files\nimport { \n  COOKIE_NAME, \n  TOKEN_EXPIRY, \n  SESSION_EXPIRY, \n  BASE_ID, \n  USERS_TABLE, \n  PROPERTIES_TABLE, \n  WELLS_TABLE, \n  ACTIVITY_TABLE,\n  BASE_URL, \n  PLAN_LIMITS, \n  ACTIVITY_LIMITS,\n  OCC_CACHE_TTL, \n  CORS_HEADERS,\n  PRICE_IDS,\n  PRICE_TO_PLAN\n} from './src/constants.js';\n\nimport { \n  jsonResponse, \n  servePage, \n  redirectWithError, \n  notFoundResponse, \n  corsResponse, \n  errorResponse \n} from './src/utils/responses.js';\n\nimport { \n  dashboardHtml, \n  loginHtml, \n  accountHtml, \n  upgradeHtml \n} from './src/templates/index.js';\n\nimport {\n  findUserByEmail,\n  getUserById,\n  countUserProperties,\n  countUserWells,\n  checkDuplicateProperty,\n  checkDuplicateWell,\n  fetchAllAirtableRecords,\n  fetchUserProperties,\n  fetchUserWells\n} from './src/services/airtable.js';\n\nimport {\n  authenticateRequest,\n  generateToken,\n  verifyToken,\n  verifySession,\n  getCookieValue\n} from './src/utils/auth.js';\n\nimport {\n  sendMagicLinkEmail,\n  sendWelcomeEmail,\n  getFreeWelcomeEmailHtml,\n  getFreeWelcomeEmailText\n} from './src/services/postmark.js';\n\n// Import all handlers from central index\nimport {\n  // Activity handlers\n  handleListActivity,\n  handleActivityStats,\n  // Property handlers\n  handleListProperties,\n  handleAddProperty,\n  handleUpdateProperty,\n  handleDeleteProperty,\n  // Wells handlers\n  handleListWells,\n  handleAddWell,\n  handleDeleteWell,\n  handleUpdateWellNotes,\n  fetchWellDetailsFromOCC,\n  // Auth handlers\n  handleSendMagicLink,\n  handleVerifyToken,\n  handleLogout,\n  handleGetCurrentUser,\n  handleRegister,\n  // Billing handlers\n  handleBillingPortal,\n  handleUpgrade,\n  handleUpgradeSuccess,\n  // Bulk handlers\n  handleBulkValidateProperties,\n  handleBulkUploadProperties,\n  handleBulkValidateWells,\n  handleBulkUploadWells,\n  // Track-well handlers\n  handleTrackThisWell,\n  validateTrackToken,\n  generateTrackWellSuccessPage,\n  generateTrackWellErrorPage\n} from './src/handlers/index.js';\n\n\n\nvar __defProp = Object.defineProperty;\nvar __name = (target, value) => __defProp(target, \"name\", { value, configurable: true });\n\nvar index_default = {\n  async fetch(request, env, ctx) {\n    const url = new URL(request.url);\n    const path = url.pathname;\n    if (request.method === \"OPTIONS\") {\n      return corsResponse();\n    }\n    try {\n      if (path === \"/\" || path === \"\") {\n        return Response.redirect(`${BASE_URL}/portal`, 302);\n      }\n      if (path === \"/portal\" || path === \"/portal/\") {\n        return servePage(dashboardHtml, request, env);\n      }\n      if (path === \"/portal/login\" || path === \"/portal/login/\") {\n        return servePage(loginHtml, request, env);\n      }\n      if (path === \"/portal/account\" || path === \"/portal/account/\") {\n        return servePage(accountHtml, request, env);\n      }\n      if (path === \"/portal/upgrade\" || path === \"/portal/upgrade/\") {\n        return servePage(upgradeHtml, request, env);\n      }\n      if (path === \"/api/auth/send-magic-link\" && request.method === \"POST\") {\n        return handleSendMagicLink(request, env);\n      }\n      if (path === \"/api/auth/verify\" && request.method === \"GET\") {\n        return handleVerifyToken(request, env, url);\n      }\n      if (path === \"/api/auth/logout\" && request.method === \"POST\") {\n        return handleLogout();\n      }\n      if (path === \"/api/auth/me\" && request.method === \"GET\") {\n        return handleGetCurrentUser(request, env);\n      }\n      if (path === \"/api/auth/register\" && request.method === \"POST\") {\n        return handleRegister(request, env);\n      }\n      \n      // Properties endpoints\n      if (path === \"/api/properties\" && request.method === \"GET\") {\n        return handleListProperties(request, env);\n      }\n      if (path === \"/api/properties\" && request.method === \"POST\") {\n        return handleAddProperty(request, env);\n      }\n      const propertyIdMatch = path.match(/^\\/api\\/properties\\/([a-zA-Z0-9]+)$/);\n      if (propertyIdMatch && request.method === \"PATCH\") {\n        return handleUpdateProperty(propertyIdMatch[1], request, env);\n      }\n      if (propertyIdMatch && request.method === \"DELETE\") {\n        return handleDeleteProperty(propertyIdMatch[1], request, env);\n      }\n      \n      // Wells endpoints\n      if (path === \"/api/wells\" && request.method === \"GET\") {\n        return handleListWells(request, env);\n      }\n      if (path === \"/api/wells\" && request.method === \"POST\") {\n        return handleAddWell(request, env);\n      }\n      const deleteWellMatch = path.match(/^\\/api\\/wells\\/([a-zA-Z0-9]+)$/);\n      if (deleteWellMatch && request.method === \"DELETE\") {\n        return handleDeleteWell(deleteWellMatch[1], request, env);\n      }\n      const wellNotesMatch = path.match(/^\\/api\\/wells\\/([a-zA-Z0-9]+)\\/notes$/);\n      if (wellNotesMatch && request.method === \"PATCH\") {\n        return handleUpdateWellNotes(wellNotesMatch[1], request, env);\n      }\n      \n      // Activity endpoint\n      if (path === \"/api/activity\" && request.method === \"GET\") {\n        return handleListActivity(request, env);\n      }\n      if (path === \"/api/activity/stats\" && request.method === \"GET\") {\n        return handleActivityStats(request, env);\n      }\n      \n      // Bulk upload endpoints\n      if (path === \"/api/bulk-validate-properties\" && request.method === \"POST\") {\n        return handleBulkValidateProperties(request, env);\n      }\n      if (path === \"/api/bulk-upload-properties\" && request.method === \"POST\") {\n        return handleBulkUploadProperties(request, env);\n      }\n      \n      // Bulk wells endpoints\n      if (path === \"/api/bulk-validate-wells\" && request.method === \"POST\") {\n        return handleBulkValidateWells(request, env);\n      }\n      if (path === \"/api/bulk-upload-wells\" && request.method === \"POST\") {\n        return handleBulkUploadWells(request, env);\n      }\n\n      \n      if (path === \"/api/billing/portal\" && request.method === \"POST\") {\n        return handleBillingPortal(request, env);\n      }\n      if (path === \"/api/upgrade\" && request.method === \"POST\") {\n        return handleUpgrade(request, env);\n      }\n      if (path === \"/api/upgrade/success\" && request.method === \"GET\") {\n        return handleUpgradeSuccess(request, env, url);\n      }\n      \n      // Track This Well endpoint\n      if (path === \"/add-well\" && request.method === \"GET\") {\n        return handleTrackThisWell(request, env, url);\n      }\n      \n      return notFoundResponse();\n    } catch (err) {\n      console.error(\"Worker error:\", err);\n      return jsonResponse({ error: \"Internal server error\" }, 500);\n    }\n  }\n};\n\n// ====================\n// SECURITY HELPERS\n// ====================\n\n// HTML escape to prevent XSS attacks from user-generated content\nfunction escapeHtml(text) {\n  if (!text) return '';\n  const str = String(text);\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n__name(escapeHtml, \"escapeHtml\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// ====================\n// HTML PAGES\n// ====================\n\n\n// HTML templates removed - now imported from separate files\n// - LOGIN_HTML\n// - DASHBOARD_HTML\n// - ACCOUNT_HTML\n// - UPGRADE_HTML\n\nexport {\n  index_default as default\n};\n\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/Users/jamesprice/mymineralwatch/mineral-watch-site/portal-worker/index.js\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/Users/jamesprice/.npm-global/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/Users/jamesprice/.npm-global/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/Users/jamesprice/mymineralwatch/mineral-watch-site/portal-worker/index.js\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/Users/jamesprice/mymineralwatch/mineral-watch-site/portal-worker/.wrangler/tmp/bundle-PKh0lS/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/Users/jamesprice/.npm-global/lib/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/Users/jamesprice/mymineralwatch/mineral-watch-site/portal-worker/.wrangler/tmp/bundle-PKh0lS/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/Users/jamesprice/mymineralwatch/mineral-watch-site/portal-worker/.wrangler/tmp/bundle-PKh0lS/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": ["generateMapLink", "generateMapLink", "__defProp", "__name"]
}
