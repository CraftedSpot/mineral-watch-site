name = "mineral-watch-monitor"
main = "src/index.js"
compatibility_date = "2024-01-01"

# Static assets
[assets]
directory = "./public"

# Environment Variables
[vars]
AIRTABLE_BASE_ID = "app3j3X29Uvp5stza"
AIRTABLE_USERS_TABLE = "tblmb8sZtfn2EW900"
AIRTABLE_PROPERTIES_TABLE = "tblbexFvBkow2ErYm"
AIRTABLE_WELLS_TABLE = "tblqWp3rb7rT3p9SA"
AIRTABLE_ACTIVITY_TABLE = "tblhBZNR5pDr620NY"
AIRTABLE_WELL_LOCATIONS_TABLE = "tblAvTwkBjU8Qwlm7"
AIRTABLE_STATEWIDE_ACTIVITY_TABLE = "tblbM8kwkRyFS9eaj"

# Set to "true" to test without sending emails or creating records
# Change to "false" when ready for production
DRY_RUN = "false"

# Worker limits
[limits]
cpu_ms = 300000  # 5 minutes CPU time for completion processing

# Cron Triggers (UTC)
# Daily digest: Every day at 7 AM CT (13:00 UTC) - sends yesterday's queued alerts
# Daily monitor: Every day at 8 AM CT (14:00 UTC) - permits, completions, status changes
# Weekly monitor: Sunday at 8 AM CT (14:00 UTC) - operator transfers, bulk status check
# Docket monitor: Mon-Fri at 12 PM CT (18:00 UTC) - court filings (moved later so OCC has time to post)
# Weekly report: Mon 00:00 UTC = Sunday 6 PM CT - weekly regional report emails
[triggers]
crons = ["0 13 * * *", "0 14 * * *", "0 14 * * 7", "0 18 * * 1-5", "0 0 * * 1"]

# KV Namespace for health tracking and caching
[[kv_namespaces]]
binding = "MINERAL_CACHE"
id = "3ca36f1a976e4dd89d65bceb4d4e3f75"

# KV Namespace for completions data cache
[[kv_namespaces]]
binding = "COMPLETIONS_CACHE"
id = "d39109ffa98d4f4d999ee37098d0c13e"

# R2 Bucket for RBDMS snapshots (optional)
[[r2_buckets]]
binding = "RBDMS_BUCKET"
bucket_name = "mineral-watch-rbdms"

# D1 Database for well data and statewide activity
[[d1_databases]]
binding = "WELLS_DB"
database_id = "9afdff90-6719-46dd-97d2-6ca3777b17c9"

# Secrets (add via wrangler secret put)
# - MINERAL_AIRTABLE_API_KEY
# - POSTMARK_API_KEY
# - TRIGGER_SECRET
# - TRACK_WELL_SECRET
