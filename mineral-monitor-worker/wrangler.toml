name = "mineral-watch-monitor"
main = "src/index.js"
compatibility_date = "2024-01-01"

# Static assets
[assets]
directory = "./public"

# Environment Variables
[vars]
AIRTABLE_BASE_ID = "app3j3X29Uvp5stza"
AIRTABLE_USERS_TABLE = "tblmb8sZtfn2EW900"
AIRTABLE_PROPERTIES_TABLE = "tblbexFvBkow2ErYm"
AIRTABLE_WELLS_TABLE = "tblqWp3rb7rT3p9SA"
AIRTABLE_ACTIVITY_TABLE = "tblhBZNR5pDr620NY"
AIRTABLE_WELL_LOCATIONS_TABLE = "tblAvTwkBjU8Qwlm7"
AIRTABLE_STATEWIDE_ACTIVITY_TABLE = "tblbM8kwkRyFS9eaj"

# Set to "true" to test without sending emails or creating records
# Change to "false" when ready for production
DRY_RUN = "false"

# Worker limits
[limits]
cpu_ms = 300000  # 5 minutes CPU time for completion processing

# Cron Triggers (UTC)
# All monitors run at 8 AM Central = 14:00 UTC (9 AM during daylight saving)
# Daily monitor: Every day at 8 AM CT - permits, completions, status changes
# Weekly monitor: Sunday at 8 AM CT - operator transfers, bulk status check
# Docket monitor: Mon-Fri at 8 AM CT - court filings
[triggers]
crons = ["0 14 * * *", "0 14 * * 0", "0 14 * * 1-5"]

# KV Namespace for health tracking and caching
[[kv_namespaces]]
binding = "MINERAL_CACHE"
id = "3ca36f1a976e4dd89d65bceb4d4e3f75"

# KV Namespace for completions data cache
[[kv_namespaces]]
binding = "COMPLETIONS_CACHE"
id = "d39109ffa98d4f4d999ee37098d0c13e"

# R2 Bucket for RBDMS snapshots (optional)
[[r2_buckets]]
binding = "RBDMS_BUCKET"
bucket_name = "mineral-watch-rbdms"

# D1 Database for well data and statewide activity
[[d1_databases]]
binding = "WELLS_DB"
database_id = "9afdff90-6719-46dd-97d2-6ca3777b17c9"

# Secrets (add via wrangler secret put)
# - MINERAL_AIRTABLE_API_KEY
# - POSTMARK_API_KEY
# - TRIGGER_SECRET
# - TRACK_WELL_SECRET
